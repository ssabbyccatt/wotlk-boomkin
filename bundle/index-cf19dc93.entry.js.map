{"version":3,"file":"index-cf19dc93.entry.js","sources":["../../../ui/core/components/raid_target_picker.ts","../../../ui/raid/presets.ts","../../../ui/raid/buff_bot.ts","../../../ui/raid/assignments_picker.ts","../../../ui/raid/blessings_picker.ts","../../../ui/raid/import_export.ts","../../../ui/raid/raid_picker.ts","../../../ui/raid/tanks_picker.ts","../../../ui/raid/raid_sim_ui.ts","../../../ui/raid/index.ts"],"sourcesContent":["import { Component } from '../components/component.js';\nimport { Input, InputConfig } from '../components/input.js';\nimport { Player } from '../player.js';\nimport { Raid } from '../raid.js';\nimport { EventID, TypedEvent } from '../typed_event.js';\nimport { RaidTarget } from '../proto/common.js';\nimport { Spec } from '../proto/common.js';\nimport { newRaidTarget, emptyRaidTarget } from '../proto_utils/utils.js';\n\ndeclare var tippy: any;\n\nexport interface RaidTargetPickerConfig<ModObject> extends InputConfig<ModObject, RaidTarget> {\n\tnoTargetLabel: string,\n\tcompChangeEmitter: TypedEvent<void>,\n}\n\nexport interface RaidTargetElemOption {\n\ticonUrl: string,\n\ttext: string,\n\tcolor: string,\n\tisDropdown: boolean,\n};\n\nexport interface RaidTargetOption extends RaidTargetElemOption {\n\tvalue: Player<any> | null,\n};\n\n// Dropdown menu for selecting a player.\nexport class RaidTargetPicker<ModObject> extends Input<ModObject, RaidTarget> {\n\tprivate readonly config: RaidTargetPickerConfig<ModObject>;\n\tprivate readonly raid: Raid;\n\tprivate readonly noTargetOption: RaidTargetOption;\n\n\tprivate curPlayer: Player<any> | null;\n\tprivate curRaidTarget: RaidTarget;\n\n\tprivate currentOptions: Array<RaidTargetOption>;\n\n\tprivate readonly buttonElem: HTMLElement;\n\tprivate readonly dropdownElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, raid: Raid, modObj: ModObject, config: RaidTargetPickerConfig<ModObject>) {\n\t\tsuper(parent, 'raid-target-picker-root', modObj, config);\n\t\tthis.rootElem.classList.add('dropdown-root');\n\t\tthis.config = config;\n\t\tthis.raid = raid;\n\t\tthis.curPlayer = this.raid.getPlayerFromRaidTarget(config.getValue(modObj));\n\t\tthis.curRaidTarget = this.getInputValue();\n\n\t\tthis.noTargetOption = {\n\t\t\ticonUrl: '',\n\t\t\ttext: config.noTargetLabel,\n\t\t\tcolor: 'black',\n\t\t\tvalue: null,\n\t\t\tisDropdown: true,\n\t\t};\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"dropdown-button raid-target-picker-button\"></div>\n\t\t\t<div class=\"dropdown-panel raid-target-picker-dropdown\"></div>\n    `;\n\n\t\tthis.buttonElem = this.rootElem.getElementsByClassName('raid-target-picker-button')[0] as HTMLElement;\n\t\tthis.dropdownElem = this.rootElem.getElementsByClassName('raid-target-picker-dropdown')[0] as HTMLElement;\n\n\t\tthis.buttonElem.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t});\n\n\t\tthis.currentOptions = [];\n\t\tthis.updateOptions(TypedEvent.nextEventID());\n\t\tconfig.compChangeEmitter.on(eventID => {\n\t\t\tthis.updateOptions(eventID);\n\t\t});\n\n\t\tthis.init();\n\t}\n\n\tprivate makeTargetOptions(): Array<RaidTargetOption> {\n\t\tconst playerOptions = this.raid.getPlayers().filter(player => player != null).map(player => {\n\t\t\treturn {\n\t\t\t\ticonUrl: player!.getTalentTreeIcon(),\n\t\t\t\ttext: player!.getLabel(),\n\t\t\t\tcolor: player!.getClassColor(),\n\t\t\t\tisDropdown: true,\n\t\t\t\tvalue: player,\n\t\t\t};\n\t\t});\n\t\treturn [this.noTargetOption].concat(playerOptions);\n\t}\n\n\tprivate updateOptions(eventID: EventID) {\n\t\tthis.currentOptions = this.makeTargetOptions();\n\n\t\tthis.dropdownElem.innerHTML = '';\n\t\tthis.currentOptions.forEach(option => this.dropdownElem.appendChild(this.makeOption(option)));\n\n\t\tconst prevRaidTarget = this.curRaidTarget;\n\t\tthis.curRaidTarget = this.getInputValue();\n\t\tif (!RaidTarget.equals(prevRaidTarget, this.curRaidTarget)) {\n\t\t\tthis.inputChanged(eventID);\n\t\t} else {\n\t\t\tthis.setInputValue(this.curRaidTarget);\n\t\t}\n\t}\n\n\tprivate makeOption(data: RaidTargetOption): HTMLElement {\n\t\tconst option = RaidTargetPicker.makeOptionElem(data);\n\n\t\toption.addEventListener('click', event => {\n\t\t\tevent.preventDefault();\n\t\t\tthis.curPlayer = data.value;\n\t\t\tthis.curRaidTarget = this.getInputValue();\n\t\t\tthis.inputChanged(TypedEvent.nextEventID());\n\t\t});\n\n\t\treturn option;\n\t}\n\n\tgetInputElem(): HTMLElement {\n\t\treturn this.buttonElem;\n\t}\n\n\tgetInputValue(): RaidTarget {\n\t\tif (this.curPlayer) {\n\t\t\treturn this.curPlayer.makeRaidTarget();\n\t\t} else {\n\t\t\treturn emptyRaidTarget();\n\t\t}\n\t}\n\n\tsetInputValue(newValue: RaidTarget) {\n\t\tthis.curRaidTarget = RaidTarget.clone(newValue);\n\t\tthis.curPlayer = this.raid.getPlayerFromRaidTarget(this.curRaidTarget);\n\n\t\tconst optionData = this.currentOptions.find(optionData => optionData.value == this.curPlayer);\n\t\tif (!optionData) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttonElem.innerHTML = '';\n\t\tthis.buttonElem.appendChild(RaidTargetPicker.makeOptionElem(optionData));\n\t}\n\n\tstatic makeOptionElem(data: RaidTargetElemOption): HTMLElement {\n\t\tconst optionContainer = document.createElement('div');\n\t\toptionContainer.classList.add('dropdown-option-container');\n\n\t\tconst option = document.createElement('div');\n\t\toption.classList.add('raid-target-picker-option');\n\t\toptionContainer.appendChild(option);\n\t\tif (data.isDropdown) {\n\t\t\toption.classList.add('dropdown-option');\n\t\t}\n\n\t\tif (data.color) {\n\t\t\toption.style.backgroundColor = data.color;\n\t\t}\n\n\t\tif (data.iconUrl) {\n\t\t\tconst icon = document.createElement('img');\n\t\t\ticon.src = data.iconUrl;\n\t\t\ticon.classList.add('raid-target-picker-icon');\n\t\t\toption.appendChild(icon);\n\t\t}\n\n\t\tif (data.text) {\n\t\t\tconst label = document.createElement('span');\n\t\t\tlabel.textContent = data.text;\n\t\t\tlabel.classList.add('raid-target-picker-label');\n\t\t\toption.appendChild(label);\n\t\t}\n\n\t\treturn optionContainer;\n\t}\n}\n","import { IndividualSimUI, OtherDefaults } from '../core/individual_sim_ui.js';\nimport { Raid as RaidProto } from '../core/proto/api.js';\nimport { Party as PartyProto } from '../core/proto/api.js';\nimport { Class } from '../core/proto/common.js';\nimport { Consumes } from '../core/proto/common.js';\n\nimport { Encounter as EncounterProto } from '../core/proto/common.js';\nimport { EquipmentSpec } from '../core/proto/common.js';\nimport { Race } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { TristateEffect } from '../core/proto/common.js';\nimport { Faction } from '../core/proto/common.js';\nimport { SavedTalents } from '../core/proto/ui.js';\nimport { SpecOptions } from '../core/proto_utils/utils.js';\nimport { SpecRotation } from '../core/proto_utils/utils.js';\nimport { playerToSpec } from '../core/proto_utils/utils.js';\nimport { specIconsLarge } from '../core/proto_utils/utils.js';\nimport { specNames } from '../core/proto_utils/utils.js';\nimport { talentTreeIcons } from '../core/proto_utils/utils.js';\nimport { NO_TARGET } from '../core/proto_utils/utils.js';\nimport { Player } from '../core/player.js';\n\nimport { BuffBot } from './buff_bot.js';\n\nimport * as DeathknightPresets from '../deathknight/presets.js';\nimport * as BalanceDruidPresets from '../balance_druid/presets.js';\nimport * as FeralDruidPresets from '../feral_druid/presets.js';\nimport * as FeralTankDruidPresets from '../feral_tank_druid/presets.js';\nimport * as ElementalShamanPresets from '../elemental_shaman/presets.js';\nimport * as EnhancementShamanPresets from '../enhancement_shaman/presets.js';\nimport * as HunterPresets from '../hunter/presets.js';\nimport * as MagePresets from '../mage/presets.js';\nimport * as RoguePresets from '../rogue/presets.js';\nimport * as RetributionPaladinPresets from '../retribution_paladin/presets.js';\nimport * as ProtectionPaladinPresets from '../protection_paladin/presets.js';\nimport * as ShadowPriestPresets from '../shadow_priest/presets.js';\nimport * as SmitePriestPresets from '../smite_priest/presets.js';\nimport * as WarriorPresets from '../warrior/presets.js';\nimport * as ProtectionWarriorPresets from '../protection_warrior/presets.js';\nimport * as WarlockPresets from '../warlock/presets.js';\n\n\nimport { BalanceDruidSimUI } from '../balance_druid/sim.js';\nimport { FeralDruidSimUI } from '../feral_druid/sim.js';\nimport { FeralTankDruidSimUI } from '../feral_tank_druid/sim.js';\nimport { EnhancementShamanSimUI } from '../enhancement_shaman/sim.js';\nimport { ElementalShamanSimUI } from '../elemental_shaman/sim.js';\nimport { HunterSimUI } from '../hunter/sim.js';\nimport { MageSimUI } from '../mage/sim.js';\nimport { RogueSimUI } from '../rogue/sim.js';\nimport { RetributionPaladinSimUI } from '../retribution_paladin/sim.js';\nimport { ProtectionPaladinSimUI } from '../protection_paladin/sim.js';\nimport { ShadowPriestSimUI } from '../shadow_priest/sim.js';\nimport { SmitePriestSimUI } from '../smite_priest/sim.js';\nimport { WarriorSimUI } from '../warrior/sim.js';\nimport { ProtectionWarriorSimUI } from '../protection_warrior/sim.js';\nimport { WarlockSimUI } from '../warlock/sim.js';\nimport { DeathknightSimUI } from '../deathknight/sim.js';\n\nexport const specSimFactories: Partial<Record<Spec, (parentElem: HTMLElement, player: Player<any>) => IndividualSimUI<any>>> = {\n    [Spec.SpecDeathknight]: (parentElem: HTMLElement, player: Player<any>) => new DeathknightSimUI(parentElem, player),\n\t[Spec.SpecBalanceDruid]: (parentElem: HTMLElement, player: Player<any>) => new BalanceDruidSimUI(parentElem, player),\n    [Spec.SpecFeralDruid]: (parentElem: HTMLElement, player: Player<any>) => new FeralDruidSimUI(parentElem, player),\n    [Spec.SpecFeralTankDruid]: (parentElem: HTMLElement, player: Player<any>) => new FeralTankDruidSimUI(parentElem, player),\n    [Spec.SpecElementalShaman]: (parentElem: HTMLElement, player: Player<any>) => new ElementalShamanSimUI(parentElem, player),\n    [Spec.SpecEnhancementShaman]: (parentElem: HTMLElement, player: Player<any>) => new EnhancementShamanSimUI(parentElem, player),\n    [Spec.SpecHunter]: (parentElem: HTMLElement, player: Player<any>) => new HunterSimUI(parentElem, player),\n    [Spec.SpecMage]: (parentElem: HTMLElement, player: Player<any>) => new MageSimUI(parentElem, player),\n    [Spec.SpecRogue]: (parentElem: HTMLElement, player: Player<any>) => new RogueSimUI(parentElem, player),\n    [Spec.SpecRetributionPaladin]: (parentElem: HTMLElement, player: Player<any>) => new RetributionPaladinSimUI(parentElem, player),\n    [Spec.SpecProtectionPaladin]: (parentElem: HTMLElement, player: Player<any>) => new ProtectionPaladinSimUI(parentElem, player),\n    [Spec.SpecShadowPriest]: (parentElem: HTMLElement, player: Player<any>) => new ShadowPriestSimUI(parentElem, player),\n    [Spec.SpecSmitePriest]: (parentElem: HTMLElement, player: Player<any>) => new SmitePriestSimUI(parentElem, player),\n    [Spec.SpecWarrior]: (parentElem: HTMLElement, player: Player<any>) => new WarriorSimUI(parentElem, player),\n    [Spec.SpecProtectionWarrior]: (parentElem: HTMLElement, player: Player<any>) => new ProtectionWarriorSimUI(parentElem, player),\n    [Spec.SpecWarlock]: (parentElem: HTMLElement, player: Player<any>) => new WarlockSimUI(parentElem, player),\n};\n\n// Configuration necessary for creating new players.\nexport interface PresetSpecSettings<SpecType extends Spec> {\n    spec: Spec,\n    rotation: SpecRotation<SpecType>,\n    talents: SavedTalents,\n    specOptions: SpecOptions<SpecType>,\n    consumes: Consumes,\n\n    defaultName: string,\n    defaultFactionRaces: Record<Faction, Race>,\n    defaultGear: Record<Faction, Record<number, EquipmentSpec>>,\n\t\totherDefaults?: OtherDefaults,\n\n    tooltip: string,\n    iconUrl: string,\n}\n\n// Configuration necessary for creating new BuffBots.\nexport interface BuffBotSettings {\n    // The value of this field must never change, to preserve local storage data.\n    buffBotId: string,\n\n    // Set this to true to remove a buff bot option after launching a real sim.\n    // This will allow users with saved settings to properly load the buffbot but\n    // also remove the buffbot as an option from the UI.\n    deprecated?: boolean,\n\n    spec: Spec,\n    name: string,\n    tooltip: string,\n    iconUrl: string,\n\n    // Callback to apply buffs from this buff bot.\n    modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => void,\n}\n\nexport const playerPresets: Array<PresetSpecSettings<any>> = [\n\t{\n\t\tspec: Spec.SpecDeathknight,\n\t\trotation: DeathknightPresets.DefaultFrostRotation,\n\t\ttalents: DeathknightPresets.FrostTalents.data,\n\t\tspecOptions: DeathknightPresets.DefaultFrostOptions,\n\t\tconsumes: DeathknightPresets.DefaultConsumes,\n\t\tdefaultName: 'Frost DK',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: DeathknightPresets.P1_FROST_BIS_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: DeathknightPresets.P1_FROST_BIS_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: DeathknightPresets.OtherDefaults,\n\t\ttooltip: 'Frost Death Knight',\n\t\ticonUrl: talentTreeIcons[Class.ClassDeathknight][1],\n\t},\n\t{\n\t\tspec: Spec.SpecDeathknight,\n\t\trotation: DeathknightPresets.DefaultUnholyRotation,\n\t\ttalents: DeathknightPresets.UnholyDualWieldTalents.data,\n\t\tspecOptions: DeathknightPresets.DefaultUnholyOptions,\n\t\tconsumes: DeathknightPresets.DefaultConsumes,\n\t\tdefaultName: 'DW Unholy DK',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: DeathknightPresets.P1_UNHOLY_DW_BIS_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: DeathknightPresets.P1_UNHOLY_DW_BIS_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: DeathknightPresets.OtherDefaults,\n\t\ttooltip: 'Dual Wield Unholy DK',\n\t\ticonUrl: talentTreeIcons[Class.ClassDeathknight][2],\n\t},\n\t{\n\t\tspec: Spec.SpecBalanceDruid,\n\t\trotation: BalanceDruidPresets.DefaultRotation,\n\t\ttalents: BalanceDruidPresets.StandardTalents.data,\n\t\tspecOptions: BalanceDruidPresets.DefaultOptions,\n\t\tconsumes: BalanceDruidPresets.DefaultConsumes,\n\t\tdefaultName: 'Balance Druid',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceTauren,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: BalanceDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: BalanceDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecBalanceDruid],\n\t\ticonUrl: specIconsLarge[Spec.SpecBalanceDruid],\n\t},\n\t{\n\t\tspec: Spec.SpecFeralDruid,\n\t\trotation: FeralDruidPresets.DefaultRotation,\n\t\ttalents: FeralDruidPresets.StandardTalents.data,\n\t\tspecOptions: FeralDruidPresets.DefaultOptions,\n\t\tconsumes: FeralDruidPresets.DefaultConsumes,\n\t\tdefaultName: 'Cat Druid',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceTauren,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: FeralDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: FeralDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecFeralDruid],\n\t\ticonUrl: specIconsLarge[Spec.SpecFeralDruid],\n\t},\n\t{\n\t\tspec: Spec.SpecFeralTankDruid,\n\t\trotation: FeralTankDruidPresets.DefaultRotation,\n\t\ttalents: FeralTankDruidPresets.StandardTalents.data,\n\t\tspecOptions: FeralTankDruidPresets.DefaultOptions,\n\t\tconsumes: FeralTankDruidPresets.DefaultConsumes,\n\t\tdefaultName: 'Bear Druid',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceTauren,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: FeralTankDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: FeralTankDruidPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecFeralTankDruid],\n\t\ticonUrl: specIconsLarge[Spec.SpecFeralTankDruid],\n\t},\n\t{\n\t\tspec: Spec.SpecHunter,\n\t\trotation: HunterPresets.DefaultRotation,\n\t\ttalents: HunterPresets.BeastMasteryTalents.data,\n\t\tspecOptions: HunterPresets.BMDefaultOptions,\n\t\tconsumes: HunterPresets.DefaultConsumes,\n\t\tdefaultName: 'BM Hunter',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'BM Hunter',\n\t\ticonUrl: talentTreeIcons[Class.ClassHunter][0],\n\t},\n\t{\n\t\tspec: Spec.SpecHunter,\n\t\trotation: HunterPresets.DefaultRotation,\n\t\ttalents: HunterPresets.MarksmanTalents.data,\n\t\tspecOptions: HunterPresets.DefaultOptions,\n\t\tconsumes: HunterPresets.DefaultConsumes,\n\t\tdefaultName: 'BM Hunter',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'MM Hunter',\n\t\ticonUrl: talentTreeIcons[Class.ClassHunter][1],\n\t},\n\t{\n\t\tspec: Spec.SpecHunter,\n\t\trotation: HunterPresets.DefaultRotation,\n\t\ttalents: HunterPresets.SurvivalTalents.data,\n\t\tspecOptions: HunterPresets.DefaultOptions,\n\t\tconsumes: HunterPresets.DefaultConsumes,\n\t\tdefaultName: 'SV Hunter',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceNightElf,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: HunterPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'SV Hunter',\n\t\ticonUrl: talentTreeIcons[Class.ClassHunter][2],\n\t},\n\t{\n\t\tspec: Spec.SpecMage,\n\t\trotation: MagePresets.DefaultArcaneRotation,\n\t\ttalents: MagePresets.ArcaneTalents.data,\n\t\tspecOptions: MagePresets.DefaultArcaneOptions,\n\t\tconsumes: MagePresets.DefaultArcaneConsumes,\n\t\tdefaultName: 'Arcane Mage',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceGnome,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: MagePresets.P1_ARCANE_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: MagePresets.P1_ARCANE_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Arcane Mage',\n\t\ticonUrl: talentTreeIcons[Class.ClassMage][0],\n\t},\n\t{\n\t\tspec: Spec.SpecMage,\n\t\trotation: MagePresets.DefaultFireRotation,\n\t\ttalents: MagePresets.FireTalents.data,\n\t\tspecOptions: MagePresets.DefaultFireOptions,\n\t\tconsumes: MagePresets.DefaultFireConsumes,\n\t\tdefaultName: 'Fire Mage',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceGnome,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: MagePresets.P1_FIRE_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: MagePresets.P1_FIRE_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Fire Mage',\n\t\ticonUrl: talentTreeIcons[Class.ClassMage][1],\n\t},\n\t{\n\t\tspec: Spec.SpecMage,\n\t\trotation: MagePresets.DefaultFrostRotation,\n\t\ttalents: MagePresets.FrostTalents.data,\n\t\tspecOptions: MagePresets.DefaultFrostOptions,\n\t\tconsumes: MagePresets.DefaultFrostConsumes,\n\t\tdefaultName: 'Frost Mage',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceGnome,\n\t\t\t[Faction.Horde]: Race.RaceTroll,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: MagePresets.P1_FROST_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: MagePresets.P1_FROST_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Frost Mage',\n\t\ticonUrl: talentTreeIcons[Class.ClassMage][2],\n\t},\n\t{\n\t\tspec: Spec.SpecRogue,\n\t\trotation: RoguePresets.DefaultRotation,\n\t\ttalents: RoguePresets.CombatTalents.data,\n\t\tspecOptions: RoguePresets.DefaultOptions,\n\t\tconsumes: RoguePresets.DefaultConsumes,\n\t\tdefaultName: 'Combat Rogue',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: RoguePresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: RoguePresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Combat Rogue',\n\t\ticonUrl: specIconsLarge[Spec.SpecRogue],\n\t},\n\t{\n\t\tspec: Spec.SpecElementalShaman,\n\t\trotation: ElementalShamanPresets.DefaultRotation,\n\t\ttalents: ElementalShamanPresets.StandardTalents.data,\n\t\tspecOptions: ElementalShamanPresets.DefaultOptions,\n\t\tconsumes: ElementalShamanPresets.DefaultConsumes,\n\t\tdefaultName: 'Ele Shaman',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDraenei,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ElementalShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ElementalShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecElementalShaman],\n\t\ticonUrl: specIconsLarge[Spec.SpecElementalShaman],\n\t},\n\t{\n\t\tspec: Spec.SpecEnhancementShaman,\n\t\trotation: EnhancementShamanPresets.DefaultRotation,\n\t\ttalents: EnhancementShamanPresets.StandardTalents.data,\n\t\tspecOptions: EnhancementShamanPresets.DefaultOptions,\n\t\tconsumes: EnhancementShamanPresets.DefaultConsumes,\n\t\tdefaultName: 'Enh Shaman',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDraenei,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: EnhancementShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: EnhancementShamanPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecEnhancementShaman],\n\t\ticonUrl: specIconsLarge[Spec.SpecEnhancementShaman],\n\t},\n\t{\n\t\tspec: Spec.SpecShadowPriest,\n\t\trotation: ShadowPriestPresets.DefaultRotation,\n\t\ttalents: ShadowPriestPresets.StandardTalents.data,\n\t\tspecOptions: ShadowPriestPresets.DefaultOptions,\n\t\tconsumes: ShadowPriestPresets.DefaultConsumes,\n\t\tdefaultName: 'Shadow Priest',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDwarf,\n\t\t\t[Faction.Horde]: Race.RaceUndead,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ShadowPriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ShadowPriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecShadowPriest],\n\t\ticonUrl: specIconsLarge[Spec.SpecShadowPriest],\n\t},\n\t{\n\t\tspec: Spec.SpecSmitePriest,\n\t\trotation: SmitePriestPresets.DefaultRotation,\n\t\ttalents: SmitePriestPresets.StandardTalents.data,\n\t\tspecOptions: SmitePriestPresets.DefaultOptions,\n\t\tconsumes: SmitePriestPresets.DefaultConsumes,\n\t\tdefaultName: 'Smite Priest',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceDwarf,\n\t\t\t[Faction.Horde]: Race.RaceUndead,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: SmitePriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: SmitePriestPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: specNames[Spec.SpecSmitePriest],\n\t\ticonUrl: specIconsLarge[Spec.SpecSmitePriest],\n\t},\n\t{\n\t\tspec: Spec.SpecWarrior,\n\t\trotation: WarriorPresets.ArmsRotation,\n\t\ttalents: WarriorPresets.ArmsTalents.data,\n\t\tspecOptions: WarriorPresets.DefaultOptions,\n\t\tconsumes: WarriorPresets.DefaultConsumes,\n\t\tdefaultName: 'Arms Warrior',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: WarriorPresets.P1_ARMS_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: WarriorPresets.P1_ARMS_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Arms Warrior',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarrior][0],\n\t},\n\t{\n\t\tspec: Spec.SpecWarrior,\n\t\trotation: WarriorPresets.DefaultRotation,\n\t\ttalents: WarriorPresets.FuryTalents.data,\n\t\tspecOptions: WarriorPresets.DefaultOptions,\n\t\tconsumes: WarriorPresets.DefaultConsumes,\n\t\tdefaultName: 'Fury Warrior',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: WarriorPresets.P1_FURY_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: WarriorPresets.P1_FURY_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Fury Warrior',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarrior][1],\n\t},\n\t{\n\t\tspec: Spec.SpecProtectionWarrior,\n\t\trotation: ProtectionWarriorPresets.DefaultRotation,\n\t\ttalents: ProtectionWarriorPresets.ImpaleProtTalents.data,\n\t\tspecOptions: ProtectionWarriorPresets.DefaultOptions,\n\t\tconsumes: ProtectionWarriorPresets.DefaultConsumes,\n\t\tdefaultName: 'Prot Warrior',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceOrc,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ProtectionWarriorPresets.P1_BALANCED_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ProtectionWarriorPresets.P1_BALANCED_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Protection Warrior',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarrior][2],\n\t},\n\t{\n\t\tspec: Spec.SpecRetributionPaladin,\n\t\trotation: RetributionPaladinPresets.DefaultRotation,\n\t\ttalents: RetributionPaladinPresets.AuraMasteryTalents.data,\n\t\tspecOptions: RetributionPaladinPresets.DefaultOptions,\n\t\tconsumes: RetributionPaladinPresets.DefaultConsumes,\n\t\tdefaultName: 'Ret Paladin',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceBloodElf,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: RetributionPaladinPresets.P1_PRESET.gear,\n\t\t\t\t2: RetributionPaladinPresets.P2_PRESET.gear,\n\t\t\t\t3: RetributionPaladinPresets.P3_PRESET.gear,\n\t\t\t\t4: RetributionPaladinPresets.P4_PRESET.gear,\n\t\t\t\t5: RetributionPaladinPresets.P5_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: RetributionPaladinPresets.P1_PRESET.gear,\n\t\t\t\t2: RetributionPaladinPresets.P2_PRESET.gear,\n\t\t\t\t3: RetributionPaladinPresets.P3_PRESET.gear,\n\t\t\t\t4: RetributionPaladinPresets.P4_PRESET.gear,\n\t\t\t\t5: RetributionPaladinPresets.P5_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Ret Paladin',\n\t\ticonUrl: talentTreeIcons[Class.ClassPaladin][2],\n\t},\n\t{\n\t\tspec: Spec.SpecProtectionPaladin,\n\t\trotation: ProtectionPaladinPresets.DefaultRotation,\n\t\ttalents: ProtectionPaladinPresets.GenericAoeTalents.data,\n\t\tspecOptions: ProtectionPaladinPresets.DefaultOptions,\n\t\tconsumes: ProtectionPaladinPresets.DefaultConsumes,\n\t\tdefaultName: 'Prot Paladin',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceBloodElf,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n\t\t\t\t1: ProtectionPaladinPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n\t\t\t\t1: ProtectionPaladinPresets.P1_PRESET.gear,\n\t\t\t},\n\t\t},\n\t\ttooltip: 'Protection Paladin',\n\t\ticonUrl: talentTreeIcons[Class.ClassPaladin][1],\n\t},\n\t/*\t{\n\t\t\tspec: Spec.SpecWarlock,\n\t\t\trotation: WarlockPresets.DefaultRotation,\n\t\t\ttalents: WarlockPresets.DestructionTalents.data,\n\t\t\tspecOptions: WarlockPresets.DefaultOptions,\n\t\t\tconsumes: WarlockPresets.DefaultConsumes,\n\t\t\tdefaultName: 'Destro Warlock',\n\t\t\tdefaultFactionRaces: {\n\t\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t\t[Faction.Horde]: Race.RaceBloodElf,\n\t\t\t},\n\t\t\tdefaultGear: {\n\t\t\t\t[Faction.Unknown]: {},\n\t\t\t\t[Faction.Alliance]: {\n\t\t\t\t\t1: WarlockPresets.P1_DESTRO.gear,\n\t\t\t\t\t2: WarlockPresets.P2_DESTRO.gear,\n\t\t\t\t\t3: WarlockPresets.P3_DESTRO.gear,\n\t\t\t\t\t4: WarlockPresets.P4_DESTRO.gear,\n\t\t\t\t\t5: WarlockPresets.P5_DESTRO.gear,\n\t\t\t\t},\n\t\t\t\t[Faction.Horde]: {\n\t\t\t\t\t1: WarlockPresets.P1_DESTRO.gear,\n\t\t\t\t\t2: WarlockPresets.P2_DESTRO.gear,\n\t\t\t\t\t3: WarlockPresets.P3_DESTRO.gear,\n\t\t\t\t\t4: WarlockPresets.P4_DESTRO.gear,\n\t\t\t\t\t5: WarlockPresets.P5_DESTRO.gear,\n\t\t\t\t},\n\t\t\t},\n\t\t\totherDefaults: WarlockPresets.OtherDefaults,\n\t\t\ttooltip: 'Destruction Warlock: defaults to casting Curse of Doom.',\n\t\t\ticonUrl: talentTreeIcons[Class.ClassWarlock][2],\n\t\t},*/\n\t{\n\t\tspec: Spec.SpecWarlock,\n\t\trotation: WarlockPresets.AfflictionRotation,\n\t\ttalents: WarlockPresets.AfflictionTalents.data,\n\t\tspecOptions: WarlockPresets.AfflictionOptions,\n\t\tconsumes: WarlockPresets.DefaultConsumes,\n\t\tdefaultName: 'Aff Warlock',\n\t\tdefaultFactionRaces: {\n\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t[Faction.Horde]: Race.RaceBloodElf,\n\t\t},\n\t\tdefaultGear: {\n\t\t\t[Faction.Unknown]: {},\n\t\t\t[Faction.Alliance]: {\n// \t\t\t\t1: WarlockPresets.P1_DESTRO.gear,\n// \t\t\t\t2: WarlockPresets.P2_DESTRO.gear,\n// \t\t\t\t3: WarlockPresets.P3_DESTRO.gear,\n// \t\t\t\t4: WarlockPresets.P4_DESTRO.gear,\n// \t\t\t\t5: WarlockPresets.P5_DESTRO.gear,\n\t\t\t},\n\t\t\t[Faction.Horde]: {\n// \t\t\t\t1: WarlockPresets.P1_DESTRO.gear,\n// \t\t\t\t2: WarlockPresets.P2_DESTRO.gear,\n// \t\t\t\t3: WarlockPresets.P3_DESTRO.gear,\n// \t\t\t\t4: WarlockPresets.P4_DESTRO.gear,\n// \t\t\t\t5: WarlockPresets.P5_DESTRO.gear,\n\t\t\t},\n\t\t},\n\t\totherDefaults: WarlockPresets.OtherDefaults,\n\t\ttooltip: 'Affliction Warlock: by default casts CoE with Malediction',\n\t\ticonUrl: talentTreeIcons[Class.ClassWarlock][0],\n\t},\n\t/*\t{\n\t\t\tspec: Spec.SpecWarlock,\n\t\t\trotation: WarlockPresets.DemonologyRotation,\n\t\t\ttalents: WarlockPresets.DemonologistTalents.data,\n\t\t\tspecOptions: WarlockPresets.DemonologyOptions,\n\t\t\tconsumes: WarlockPresets.DefaultConsumes,\n\t\t\tdefaultName: 'Demo Warlock',\n\t\t\tdefaultFactionRaces: {\n\t\t\t\t[Faction.Unknown]: Race.RaceUnknown,\n\t\t\t\t[Faction.Alliance]: Race.RaceHuman,\n\t\t\t\t[Faction.Horde]: Race.RaceBloodElf,\n\t\t\t},\n\t\t\tdefaultGear: {\n\t\t\t\t[Faction.Unknown]: {},\n\t\t\t\t[Faction.Alliance]: {\n\t\t\t\t\t1: WarlockPresets.P1_DESTRO.gear,\n\t\t\t\t\t2: WarlockPresets.P2_DESTRO.gear,\n\t\t\t\t\t3: WarlockPresets.P3_DESTRO.gear,\n\t\t\t\t\t4: WarlockPresets.P4_DESTRO.gear,\n\t\t\t\t\t5: WarlockPresets.P5_DESTRO.gear,\n\t\t\t\t},\n\t\t\t\t[Faction.Horde]: {\n\t\t\t\t\t1: WarlockPresets.P1_DESTRO.gear,\n\t\t\t\t\t2: WarlockPresets.P2_DESTRO.gear,\n\t\t\t\t\t3: WarlockPresets.P3_DESTRO.gear,\n\t\t\t\t\t4: WarlockPresets.P4_DESTRO.gear,\n\t\t\t\t\t5: WarlockPresets.P5_DESTRO.gear,\n\t\t\t\t},\n\t\t\t},\n\t\t\totherDefaults: WarlockPresets.OtherDefaults,\n\t\t\ttooltip: 'Demonology Warlock',\n\t\t\ticonUrl: talentTreeIcons[Class.ClassWarlock][1],\n\t\t},*/\n];\n\nexport const implementedSpecs: Array<Spec> = [...new Set(playerPresets.map(preset => preset.spec))];\n\nexport const buffBotPresets: Array<BuffBotSettings> = [\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Bear',\n        deprecated: true,\n        spec: Spec.SpecBalanceDruid,\n        name: 'Bear',\n        tooltip: 'Bear: Adds Gift of the Wild, an Innervate, Faerie Fire, and Leader of the Pack.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_racial_bearform.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.giftOfTheWild = Math.max(raidProto.buffs!.giftOfTheWild, TristateEffect.TristateEffectRegular);\n            raidProto.buffs!.thorns = Math.max(raidProto.buffs!.thorns, TristateEffect.TristateEffectRegular);\n            raidProto.debuffs!.faerieFire = Math.max(raidProto.debuffs!.faerieFire, TristateEffect.TristateEffectRegular);\n            raidProto.buffs!.leaderOfThePack = Math.max(raidProto.buffs!.leaderOfThePack, TristateEffect.TristateEffectRegular);\n\n            const innervateIndex = buffBot.getInnervateAssignment().targetIndex;\n            if (innervateIndex != NO_TARGET) {\n                const partyIndex = Math.floor(innervateIndex / 5);\n                const playerIndex = innervateIndex % 5;\n                const playerProto = raidProto.parties[partyIndex].players[playerIndex];\n                if (playerProto.buffs) {\n                    playerProto.buffs.innervates++;\n                }\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Resto Druid',\n        spec: Spec.SpecBalanceDruid,\n        name: 'Resto Druid',\n        tooltip: 'Resto Druid: Adds Improved Gift of the Wild, and an Innervate.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.giftOfTheWild = TristateEffect.TristateEffectImproved;\n            raidProto.buffs!.thorns = Math.max(raidProto.buffs!.thorns, TristateEffect.TristateEffectRegular);\n\n            const innervateIndex = buffBot.getInnervateAssignment().targetIndex;\n            if (innervateIndex != NO_TARGET) {\n                const partyIndex = Math.floor(innervateIndex / 5);\n                const playerIndex = innervateIndex % 5;\n                const playerProto = raidProto.parties[partyIndex].players[playerIndex];\n                if (playerProto.buffs) {\n                    playerProto.buffs.innervates++;\n                }\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Dreamstate',\n        spec: Spec.SpecBalanceDruid,\n        name: 'Dreamstate',\n        tooltip: 'Dreamstate: Adds Improved Gift of the Wild, an Innervate, and Improved Faerie Fire.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_nature_faeriefire.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.giftOfTheWild = TristateEffect.TristateEffectImproved;\n            raidProto.buffs!.thorns = TristateEffect.TristateEffectImproved;\n            raidProto.debuffs!.faerieFire = TristateEffect.TristateEffectImproved;\n\n            const innervateIndex = buffBot.getInnervateAssignment().targetIndex;\n            if (innervateIndex != NO_TARGET) {\n                const partyIndex = Math.floor(innervateIndex / 5);\n                const playerIndex = innervateIndex % 5;\n                const playerProto = raidProto.parties[partyIndex].players[playerIndex];\n                if (playerProto.buffs) {\n                    playerProto.buffs.innervates++;\n                }\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Mage',\n        deprecated: true,\n        spec: Spec.SpecMage,\n        name: 'Mage',\n        tooltip: 'Mage: Adds Arcane Brilliance.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_arcaneintellect.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.arcaneBrilliance = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Paladin',\n        spec: Spec.SpecRetributionPaladin,\n        name: 'Holy Paladin',\n        tooltip: 'Holy Paladin: Adds a set of blessings.',\n        iconUrl: talentTreeIcons[Class.ClassPaladin][0],\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            // Do nothing, blessings are handled elswhere.\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'JoW Paladin',\n        spec: Spec.SpecRetributionPaladin,\n        name: 'JoW Paladin',\n        tooltip: 'JoW Paladin: Adds a set of blessings and Judgement of Wisdom.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousnessaura.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            // Blessings are handled elswhere.\n            raidProto.debuffs!.judgementOfWisdom = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Holy Priest',\n        spec: Spec.SpecShadowPriest,\n        name: 'Holy Priest',\n        tooltip: 'Holy Priest: Adds Improved PW Fortitude and Shadow Protection.',\n        iconUrl: talentTreeIcons[Class.ClassPriest][1],\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.shadowProtection = true;\n            raidProto.buffs!.powerWordFortitude = TristateEffect.TristateEffectImproved;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Divine Spirit Priest',\n        spec: Spec.SpecShadowPriest,\n        name: 'Disc Priest',\n        tooltip: 'Disc Priest: Adds Improved PW Fort, Shadow Protection, Improved Divine Spirit and a Power Infusion.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/spell_holy_powerinfusion.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.shadowProtection = true;\n            raidProto.buffs!.powerWordFortitude = TristateEffect.TristateEffectImproved;\n            raidProto.buffs!.divineSpirit = true;\n\n\t\t\tconst powerInfusionIndex = buffBot.getPowerInfusionAssignment().targetIndex;\n\t\t\tif (powerInfusionIndex != NO_TARGET) {\n\t\t\t\tconst partyIndex = Math.floor(powerInfusionIndex / 5);\n\t\t\t\tconst playerIndex = powerInfusionIndex % 5;\n\t\t\t\tconst playerProto = raidProto.parties[partyIndex].players[playerIndex];\n\t\t\t\tif (playerProto.buffs) {\n\t\t\t\t\tplayerProto.buffs.powerInfusions++;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\t{\n\t\t// The value of this field must never change, to preserve local storage data.\n\t\tbuffBotId: 'Rogue',\n\t\tspec: Spec.SpecShadowPriest,\n\t\tname: 'Rogue',\n\t\ttooltip: 'Rogue: Adds TotT.',\n\t\ticonUrl: 'https://wow.zamimg.com/images/wow/icons/large/ability_rogue_tricksofthetrade.jpg',\n\t\tmodifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n\t\t\tconst tricksOfTheTradeIndex = buffBot.getTricksOfTheTradeAssignment().targetIndex;\n\t\t\tif (tricksOfTheTradeIndex != NO_TARGET) {\n\t\t\t\tconst partyIndex = Math.floor(tricksOfTheTradeIndex / 5);\n\t\t\t\tconst playerIndex = tricksOfTheTradeIndex % 5;\n\t\t\t\tconst playerProto = raidProto.parties[partyIndex].players[playerIndex];\n\t\t\t\tif (playerProto.buffs) {\n\t\t\t\t\tplayerProto.buffs.tricksOfTheTrades++;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\t{\n\t\t// The value of this field must never change, to preserve local storage data.\n\t\tbuffBotId: 'Resto Shaman',\n\t\tspec: Spec.SpecElementalShaman,\n\t\tname: 'Resto Shaman',\n\t\ttooltip: 'Resto Shaman: Adds Bloodlust, Mana Spring Totem, Mana Tide Totem, Strength of Earth Totem. Chooses air totem based on party composition.',\n\t\ticonUrl: talentTreeIcons[Class.ClassShaman][2],\n\t\tmodifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n\t\t\traidProto.buffs!.bloodlust = true;\n\t\t\traidProto.buffs!.manaSpringTotem = TristateEffect.TristateEffectImproved;\n\t\t\tpartyProto.buffs!.manaTideTotems++;\n\n            // Choose which air totem to drop based on party composition.\n            const woaSpecs = [\n                Spec.SpecBalanceDruid,\n                Spec.SpecMage,\n                Spec.SpecShadowPriest,\n                Spec.SpecSmitePriest,\n                Spec.SpecEnhancementShaman,\n                Spec.SpecElementalShaman,\n                Spec.SpecWarlock,\n            ];\n            const wfSpecs = [\n                Spec.SpecRetributionPaladin,\n                Spec.SpecRogue,\n                Spec.SpecWarrior,\n                Spec.SpecProtectionWarrior,\n                Spec.SpecFeralDruid,\n                Spec.SpecFeralTankDruid,\n            ];\n            const [woaVotes, wfVotes] = [woaSpecs, wfSpecs]\n                .map(specs => partyProto.players\n                    .filter(player => player.class != Class.ClassUnknown)\n                    .map(player => playerToSpec(player))\n                    .filter(playerSpec => specs.includes(playerSpec))\n                    .length);\n\n            if (woaVotes >= wfVotes) {\n                raidProto.buffs!.wrathOfAirTotem = true;\n            } else {\n                raidProto.buffs!.windfuryTotem = TristateEffect.TristateEffectRegular;\n            }\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Arms Warrior',\n        deprecated: true,\n        spec: Spec.SpecWarrior,\n        name: 'Arms Warrior',\n        tooltip: 'Arms Warrior: Adds Sunder Armor, Blood Frenzy, and Improved Battle Shout.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/ability_warrior_savageblow.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.battleShout = TristateEffect.TristateEffectImproved;\n            const debuffs = raidProto.debuffs!;\n            debuffs.sunderArmor = true;\n            debuffs.bloodFrenzy = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Fury Warrior',\n        deprecated: true,\n        spec: Spec.SpecWarrior,\n        name: 'Fury Warrior',\n        tooltip: 'Fury Warrior: Adds Sunder Armor and Improved Battle Shout.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/ability_warrior_innerrage.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            raidProto.buffs!.battleShout = TristateEffect.TristateEffectImproved;\n            const debuffs = raidProto.debuffs!;\n            debuffs.sunderArmor = true;\n        },\n    },\n    {\n        // The value of this field must never change, to preserve local storage data.\n        buffBotId: 'Prot Warrior',\n        deprecated: true,\n        spec: Spec.SpecWarrior,\n        name: 'Prot Warrior',\n        tooltip: 'Prot Warrior: Adds Sunder Armor.',\n        iconUrl: 'https://wow.zamimg.com/images/wow/icons/medium/inv_shield_06.jpg',\n        modifyRaidProto: (buffBot: BuffBot, raidProto: RaidProto, partyProto: PartyProto) => {\n            const debuffs = raidProto.debuffs!;\n            debuffs.sunderArmor = true;\n        },\n    },\n];\n","import { Class } from '../core/proto/common.js';\nimport { RaidTarget } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { BuffBot as BuffBotProto } from '../core/proto/ui.js';\nimport { classColors } from '../core/proto_utils/utils.js';\nimport { emptyRaidTarget } from '../core/proto_utils/utils.js';\nimport { specToClass } from '../core/proto_utils/utils.js';\nimport { Sim } from '../core/sim.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { BuffBotSettings, buffBotPresets } from './presets.js';\n\nexport const NO_ASSIGNMENT = -1;\n\n// Represents a buff bot in a raid.\nexport class BuffBot {\n\tsettings: BuffBotSettings;\n\tspec: Spec = 0;\n\tname: string = '';\n\n\tprivate raidIndex: number = NO_ASSIGNMENT;\n\tprivate innervateAssignment: RaidTarget = emptyRaidTarget();\n\tprivate powerInfusionAssignment: RaidTarget = emptyRaidTarget();\n\tprivate tricksOfTheTradeAssignment: RaidTarget = emptyRaidTarget();\n\n\treadonly raidIndexChangeEmitter = new TypedEvent<void>();\n\treadonly innervateAssignmentChangeEmitter = new TypedEvent<void>();\n\treadonly powerInfusionAssignmentChangeEmitter = new TypedEvent<void>();\n\treadonly tricksOfTheTradeAssignmentChangeEmitter = new TypedEvent<void>();\n\treadonly changeEmitter = new TypedEvent<void>();\n\n\tprivate readonly sim: Sim;\n\n\tconstructor(id: string, sim: Sim) {\n\t\tconst settings = buffBotPresets.find(preset => preset.buffBotId == id);\n\t\tif (!settings) {\n\t\t\tthrow new Error('No buff bot config with id \\'' + id + '\\'!');\n\t\t}\n\n\t\tthis.sim = sim;\n\t\tthis.settings = settings;\n\t\tthis.updateSettings();\n\n\t\t[\n\t\t\tthis.raidIndexChangeEmitter,\n\t\t\tthis.innervateAssignmentChangeEmitter,\n\t\t\tthis.powerInfusionAssignmentChangeEmitter,\n\t\t\tthis.tricksOfTheTradeAssignmentChangeEmitter,\n\t\t].forEach(emitter => emitter.on(eventID => this.changeEmitter.emit(eventID)));\n\n\t\tthis.changeEmitter.on(eventID => sim.raid.getParty(this.getPartyIndex()).changeEmitter.emit(eventID));\n\t}\n\n\tprivate updateSettings() {\n\t\tthis.spec = this.settings.spec;\n\t\tthis.name = this.settings.name;\n\t}\n\n\tgetLabel(): string {\n\t\treturn `${this.name} (#${this.getRaidIndex() + 1})`;\n\t}\n\n\tgetClass(): Class {\n\t\treturn specToClass[this.settings.spec];\n\t}\n\n\tgetClassColor(): string {\n\t\treturn classColors[this.getClass()];\n\t}\n\n\tgetRaidIndex(): number {\n\t\treturn this.raidIndex;\n\t}\n\tsetRaidIndex(eventID: EventID, newRaidIndex: number) {\n\t\tif (newRaidIndex != this.raidIndex) {\n\t\t\tthis.raidIndex = newRaidIndex;\n\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\tthis.raidIndexChangeEmitter.emit(eventID);\n\t\t\t\tthis.sim.raid.compChangeEmitter.emit(eventID);\n\t\t\t});\n\t\t}\n\t}\n\n\tgetPartyIndex(): number {\n\t\treturn Math.floor(this.getRaidIndex() / 5);\n\t}\n\n\tgetInnervateAssignment(): RaidTarget {\n\t\t// Defensive copy.\n\t\treturn RaidTarget.clone(this.innervateAssignment);\n\t}\n\tsetInnervateAssignment(eventID: EventID, newInnervateAssignment: RaidTarget) {\n\t\tif (RaidTarget.equals(newInnervateAssignment, this.innervateAssignment))\n\t\t\treturn;\n\n\t\t// Defensive copy.\n\t\tthis.innervateAssignment = RaidTarget.clone(newInnervateAssignment);\n\t\tthis.innervateAssignmentChangeEmitter.emit(eventID);\n\t}\n\n\tgetPowerInfusionAssignment(): RaidTarget {\n\t\t// Defensive copy.\n\t\treturn RaidTarget.clone(this.powerInfusionAssignment);\n\t}\n\tsetPowerInfusionAssignment(eventID: EventID, newPowerInfusionAssignment: RaidTarget) {\n\t\tif (RaidTarget.equals(newPowerInfusionAssignment, this.powerInfusionAssignment))\n\t\t\treturn;\n\n\t\t// Defensive copy.\n\t\tthis.powerInfusionAssignment = RaidTarget.clone(newPowerInfusionAssignment);\n\t\tthis.powerInfusionAssignmentChangeEmitter.emit(eventID);\n\t}\n\n\tgetTricksOfTheTradeAssignment(): RaidTarget {\n\t\t// Defensive copy.\n\t\treturn RaidTarget.clone(this.tricksOfTheTradeAssignment);\n\t}\n\tsetTricksOfTheTradeAssignment(eventID: EventID, newTricksOfTheTradeAssignment: RaidTarget) {\n\t\tif (RaidTarget.equals(newTricksOfTheTradeAssignment, this.tricksOfTheTradeAssignment))\n\t\t\treturn;\n\n\t\t// Defensive copy.\n\t\tthis.tricksOfTheTradeAssignment = RaidTarget.clone(newTricksOfTheTradeAssignment);\n\t\tthis.tricksOfTheTradeAssignmentChangeEmitter.emit(eventID);\n\t}\n\n\ttoProto(): BuffBotProto {\n\t\treturn BuffBotProto.create({\n\t\t\tid: this.settings.buffBotId,\n\t\t\traidIndex: this.getRaidIndex(),\n\t\t\tinnervateAssignment: this.getInnervateAssignment(),\n\t\t\tpowerInfusionAssignment: this.getPowerInfusionAssignment(),\n\t\t\ttricksOfTheTradeAssignment: this.getTricksOfTheTradeAssignment(),\n\t\t});\n\t}\n\n\tfromProto(eventID: EventID, proto: BuffBotProto) {\n\t\tconst settings = buffBotPresets.find(preset => preset.buffBotId == proto.id);\n\t\tif (!settings) {\n\t\t\tthrow new Error('No buff bot config with id \\'' + proto.id + '\\'!');\n\t\t}\n\t\tthis.settings = settings;\n\t\tthis.updateSettings();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.setRaidIndex(eventID, proto.raidIndex);\n\t\t\tthis.setInnervateAssignment(eventID, proto.innervateAssignment || emptyRaidTarget());\n\t\t\tthis.setPowerInfusionAssignment(eventID, proto.powerInfusionAssignment || emptyRaidTarget());\n\t\t\tthis.setTricksOfTheTradeAssignment(eventID, proto.tricksOfTheTradeAssignment || emptyRaidTarget());\n\t\t});\n\t}\n\n\tclone(eventID: EventID): BuffBot {\n\t\tconst newBuffBot = new BuffBot(this.settings.buffBotId, this.sim);\n\t\tnewBuffBot.fromProto(eventID, this.toProto());\n\t\treturn newBuffBot;\n\t}\n}\n","import { Component } from '../core/components/component.js';\nimport { Input, InputConfig } from '../core/components/input.js';\nimport { RaidTargetPicker } from '../core/components/raid_target_picker.js';\nimport { Player } from '../core/player.js';\nimport { Raid } from '../core/raid.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { Class } from '../core/proto/common.js';\nimport { RaidTarget } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { getEnumValues } from '../core/utils.js';\nimport { wait } from '../core/utils.js';\nimport { emptyRaidTarget } from '../core/proto_utils/utils.js';\n\nimport { BuffBot } from './buff_bot.js';\nimport { RaidSimUI } from './raid_sim_ui.js';\n\ndeclare var tippy: any;\n\nexport class AssignmentsPicker extends Component {\n    readonly raidSimUI: RaidSimUI;\n    readonly changeEmitter: TypedEvent<void> = new TypedEvent<void>();\n\n\tprivate readonly innervatesPicker: InnervatesPicker;\n\tprivate readonly powerInfusionsPicker: PowerInfusionsPicker;\n\tprivate readonly tricksOfTheTradesPicker: TricksOfTheTradesPicker;\n\n\tconstructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parentElem, 'assignments-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\t\tthis.innervatesPicker = new InnervatesPicker(this.rootElem, raidSimUI);\n\t\tthis.powerInfusionsPicker = new PowerInfusionsPicker(this.rootElem, raidSimUI);\n\t\tthis.tricksOfTheTradesPicker = new TricksOfTheTradesPicker(this.rootElem, raidSimUI);\n\t}\n}\n\ninterface AssignmentTargetPicker {\n    playerOrBot: Player<any> | BuffBot,\n    targetPicker: RaidTargetPicker<Player<any>> | RaidTargetPicker<BuffBot>,\n    targetPlayer: Player<any> | null;\n};\n\nabstract class AssignedBuffPicker extends Component {\n    readonly raidSimUI: RaidSimUI;\n    readonly changeEmitter: TypedEvent<void> = new TypedEvent<void>();\n\n    private readonly playersContainer: HTMLElement;\n\n    private targetPickers: Array<AssignmentTargetPicker>;\n\n    constructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n        super(parentElem, 'assigned-buff-picker-root');\n        this.raidSimUI = raidSimUI;\n        this.targetPickers = [];\n\n        this.playersContainer = document.createElement('fieldset');\n        this.playersContainer.classList.add('assigned-buff-players-container', 'settings-section');\n        this.rootElem.appendChild(this.playersContainer);\n\n        this.update();\n        this.raidSimUI.changeEmitter.on(eventID => {\n            this.update();\n        });\n    }\n\n    private update() {\n        this.playersContainer.innerHTML = `\n\t\t\t<legend>${this.getTitle().toUpperCase()}</legend>\n\t\t`;\n\n        const sourcePlayers = this.getSourcePlayers();\n        if (sourcePlayers.length == 0) {\n            this.rootElem.style.display = 'none';\n        } else {\n            this.rootElem.style.display = 'initial';\n        }\n\n        this.targetPickers = sourcePlayers.map((sourcePlayer, sourcePlayerIndex) => {\n            const row = document.createElement('div');\n            row.classList.add('assigned-buff-player');\n            this.playersContainer.appendChild(row);\n\n            const sourceElem = RaidTargetPicker.makeOptionElem({\n                iconUrl: sourcePlayer instanceof Player ? sourcePlayer.getTalentTreeIcon() : sourcePlayer.settings.iconUrl,\n                text: sourcePlayer.getLabel(),\n                color: sourcePlayer.getClassColor(),\n                isDropdown: false,\n            });\n            sourceElem.classList.add('raid-target-picker-root');\n            row.appendChild(sourceElem);\n\n            const arrow = document.createElement('span');\n            arrow.classList.add('assigned-buff-arrow', 'fa', 'fa-arrow-right');\n            row.appendChild(arrow);\n\n            let raidTargetPicker: RaidTargetPicker<Player<any>> | RaidTargetPicker<BuffBot> | null = null;\n            if (sourcePlayer instanceof Player) {\n                raidTargetPicker = new RaidTargetPicker<Player<any>>(row, this.raidSimUI.sim.raid, sourcePlayer, {\n                    extraCssClasses: [\n                        'assigned-buff-target-picker',\n                    ],\n                    noTargetLabel: 'Unassigned',\n                    compChangeEmitter: this.raidSimUI.sim.raid.compChangeEmitter,\n\n                    changedEvent: (player: Player<any>) => player.specOptionsChangeEmitter,\n                    getValue: (player: Player<any>) => this.getPlayerValue(player),\n                    setValue: (eventID: EventID, player: Player<any>, newValue: RaidTarget) => this.setPlayerValue(eventID, player, newValue),\n                });\n            } else {\n                raidTargetPicker = new RaidTargetPicker<BuffBot>(row, this.raidSimUI.sim.raid, sourcePlayer, {\n                    extraCssClasses: [\n                        'assigned-buff-target-picker',\n                    ],\n                    noTargetLabel: 'Unassigned',\n                    compChangeEmitter: this.raidSimUI.sim.raid.compChangeEmitter,\n\n                    changedEvent: (buffBot: BuffBot) => buffBot.changeEmitter,\n                    getValue: (buffBot: BuffBot) => this.getBuffBotValue(buffBot),\n                    setValue: (eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) => this.setBuffBotValue(eventID, buffBot, newValue),\n                });\n            }\n\n            const targetPickerData = {\n                playerOrBot: sourcePlayer,\n                targetPicker: raidTargetPicker!,\n                targetPlayer: this.raidSimUI.sim.raid.getPlayerFromRaidTarget(raidTargetPicker!.getInputValue()),\n            };\n\n            raidTargetPicker!.changeEmitter.on(eventID => {\n                targetPickerData.targetPlayer = this.raidSimUI.sim.raid.getPlayerFromRaidTarget(raidTargetPicker!.getInputValue());\n            });\n\n            return targetPickerData;\n        });\n    }\n\n    abstract getTitle(): string;\n    abstract getSourcePlayers(): Array<Player<any> | BuffBot>;\n\n    abstract getPlayerValue(player: Player<any>): RaidTarget;\n    abstract setPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget): void;\n\n    abstract getBuffBotValue(buffBot: BuffBot): RaidTarget;\n    abstract setBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget): void;\n}\n\nclass InnervatesPicker extends AssignedBuffPicker {\n    getTitle(): string {\n        return 'Innervates';\n    }\n\n    getSourcePlayers(): Array<Player<any> | BuffBot> {\n        return this.raidSimUI.getPlayersAndBuffBots().filter(playerOrBot => playerOrBot?.getClass() == Class.ClassDruid) as Array<Player<any> | BuffBot>;\n    }\n\n    getPlayerValue(player: Player<any>): RaidTarget {\n        return (player as Player<Spec.SpecBalanceDruid>).getSpecOptions().innervateTarget || emptyRaidTarget();\n    }\n\n    setPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget) {\n        const newOptions = (player as Player<Spec.SpecBalanceDruid>).getSpecOptions();\n        newOptions.innervateTarget = newValue;\n        player.setSpecOptions(eventID, newOptions);\n    }\n\n    getBuffBotValue(buffBot: BuffBot): RaidTarget {\n        return buffBot.getInnervateAssignment();\n    }\n\n    setBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) {\n        buffBot.setInnervateAssignment(eventID, newValue);\n    }\n}\n\nclass PowerInfusionsPicker extends AssignedBuffPicker {\n    getTitle(): string {\n        return 'Power Infusions';\n    }\n\n    getSourcePlayers(): Array<Player<any> | BuffBot> {\n        return this.raidSimUI.getPlayersAndBuffBots()\n            .filter(playerOrBot => playerOrBot?.getClass() == Class.ClassPriest)\n            .filter(playerOrBot => {\n                if (playerOrBot instanceof BuffBot) {\n                    return playerOrBot.settings.buffBotId == 'Divine Spirit Priest';\n                } else {\n                    const player = playerOrBot as Player<any>;\n                    if (!(player as Player<Spec.SpecSmitePriest>).getTalents().powerInfusion) {\n                        return false;\n                    }\n                    // Don't include shadow priests even if they have the talent, because they\n                    // don't have a raid target option for this.\n                    return player.spec == Spec.SpecSmitePriest;\n                }\n            }) as Array<Player<any> | BuffBot>;\n    }\n\n    getPlayerValue(player: Player<any>): RaidTarget {\n        return (player as Player<Spec.SpecSmitePriest>).getSpecOptions().powerInfusionTarget || emptyRaidTarget();\n    }\n\n    setPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget) {\n        const newOptions = (player as Player<Spec.SpecSmitePriest>).getSpecOptions();\n        newOptions.powerInfusionTarget = newValue;\n        player.setSpecOptions(eventID, newOptions);\n    }\n\n    getBuffBotValue(buffBot: BuffBot): RaidTarget {\n        return buffBot.getPowerInfusionAssignment();\n    }\n\n    setBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) {\n        buffBot.setPowerInfusionAssignment(eventID, newValue);\n    }\n}\n\nclass TricksOfTheTradesPicker extends AssignedBuffPicker {\n\tgetTitle(): string {\n\t\treturn 'Tricks of the Trades';\n\t}\n\n\tgetSourcePlayers(): Array<Player<any> | BuffBot> {\n\t\treturn this.raidSimUI.getPlayersAndBuffBots().filter(playerOrBot => playerOrBot?.getClass() == Class.ClassRogue) as Array<Player<any> | BuffBot>;\n\t}\n\n\tgetPlayerValue(player: Player<any>): RaidTarget {\n\t\treturn (player as Player<Spec.SpecRogue>).getSpecOptions().tricksOfTheTradeTarget || emptyRaidTarget();\n\t}\n\n\tsetPlayerValue(eventID: EventID, player: Player<any>, newValue: RaidTarget) {\n\t\tconst newOptions = (player as Player<Spec.SpecRogue>).getSpecOptions();\n\t\tnewOptions.tricksOfTheTradeTarget = newValue;\n\t\tplayer.setSpecOptions(eventID, newOptions);\n\t}\n\n\tgetBuffBotValue(buffBot: BuffBot): RaidTarget {\n\t\treturn buffBot.getTricksOfTheTradeAssignment();\n\t}\n\n\tsetBuffBotValue(eventID: EventID, buffBot: BuffBot, newValue: RaidTarget) {\n\t\tbuffBot.setTricksOfTheTradeAssignment(eventID, newValue);\n\t}\n}\n","import { Component } from '../core/components/component.js';\nimport { IconEnumPicker } from '../core/components/icon_enum_picker.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { Class } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { Blessings } from '../core/proto/paladin.js';\nimport { BlessingsAssignment } from '../core/proto/ui.js';\nimport { BlessingsAssignments } from '../core/proto/ui.js';\nimport { ActionId } from '../core/proto_utils/action_id.js';\nimport {\n\tmakeDefaultBlessings,\n\tclassColors,\n\tnaturalSpecOrder,\n\tspecNames,\n\ttitleIcons,\n} from '../core/proto_utils/utils.js';\nimport { getEnumValues } from '../core/utils.js';\n\nimport { RaidSimUI } from './raid_sim_ui.js';\nimport { implementedSpecs } from './presets.js';\n\ndeclare var tippy: any;\n\nconst MAX_PALADINS = 4;\n\nexport class BlessingsPicker extends Component {\n\treadonly raidSimUI: RaidSimUI;\n\treadonly changeEmitter: TypedEvent<void> = new TypedEvent<void>();\n\n\tprivate readonly rows: Array<HTMLTableRowElement>;\n\tprivate readonly cols: Array<Array<HTMLElement>>;\n\n\tprivate assignments: BlessingsAssignments;\n\n\tconstructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parentElem, 'blessings-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\t\tthis.assignments = BlessingsAssignments.clone(makeDefaultBlessings(4));\n\n\t\tthis.rootElem.innerHTML = `\n\t\t<table class=\"blessings-table\">\n\t\t\t<tbody class=\"blessings-table-body\">\n\t\t\t</tbody>\n\t\t</table>\n\t\t`;\n\n\t\tconst headerRow = this.rootElem.getElementsByClassName('blessings-table-header-row')[0] as HTMLTableRowElement;\n\t\tconst bodyElem = this.rootElem.getElementsByClassName('blessings-table-body')[0] as HTMLTableSectionElement;\n\n\t\tconst specs = naturalSpecOrder.filter(spec => implementedSpecs.includes(spec));\n\t\tconst paladinIndexes = [...Array(MAX_PALADINS).keys()];\n\n\t\tthis.cols = [];\n\t\tthis.rows = specs.map(spec => {\n\t\t\tconst row = document.createElement('tr');\n\t\t\trow.classList.add('blessings-table-row');\n\t\t\tbodyElem.appendChild(row);\n\n\t\t\tconst headerCell = document.createElement('th');\n\t\t\theaderCell.classList.add('blessings-table-header-cell');\n\t\t\trow.appendChild(headerCell);\n\n\t\t\tconst icon = document.createElement('img');\n\t\t\ticon.src = titleIcons[spec];\n\t\t\theaderCell.appendChild(icon);\n\n\t\t\ttippy(icon, {\n\t\t\t\t'content': specNames[spec],\n\t\t\t\t'allowHTML': true,\n\t\t\t});\n\n\t\t\tpaladinIndexes.forEach(paladinIdx => {\n\t\t\t\tconst cell = document.createElement('td');\n\t\t\t\tcell.classList.add('blessings-table-cell');\n\t\t\t\trow.appendChild(cell);\n\n\t\t\t\tif (!this.cols[paladinIdx]) {\n\t\t\t\t\tthis.cols.push([]);\n\t\t\t\t}\n\t\t\t\tthis.cols[paladinIdx].push(cell);\n\n\t\t\t\tconst blessingPicker = new IconEnumPicker(cell, this, {\n\t\t\t\t\textraCssClasses: [\n\t\t\t\t\t\t'blessing-picker',\n\t\t\t\t\t],\n\t\t\t\t\tnumColumns: 1,\n\t\t\t\t\tvalues: [\n\t\t\t\t\t\t{ color: classColors[Class.ClassPaladin], value: Blessings.BlessingUnknown },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(25898), value: Blessings.BlessingOfKings },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(48934), value: Blessings.BlessingOfMight },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(48938), value: Blessings.BlessingOfWisdom },\n\t\t\t\t\t\t{ actionId: ActionId.fromSpellId(25899), value: Blessings.BlessingOfSanctuary },\n\t\t\t\t\t],\n\t\t\t\t\tequals: (a: Blessings, b: Blessings) => a == b,\n\t\t\t\t\tzeroValue: Blessings.BlessingUnknown,\n\t\t\t\t\tchangedEvent: (picker: BlessingsPicker) => picker.changeEmitter,\n\t\t\t\t\tgetValue: (picker: BlessingsPicker) => picker.assignments.paladins[paladinIdx]?.blessings[spec] || Blessings.BlessingUnknown,\n\t\t\t\t\tsetValue: (eventID: EventID, picker: BlessingsPicker, newValue: number) => {\n\t\t\t\t\t\tconst currentValue = picker.assignments.paladins[paladinIdx].blessings[spec];\n\t\t\t\t\t\tif (currentValue != newValue) {\n\t\t\t\t\t\t\tpicker.assignments.paladins[paladinIdx].blessings[spec] = newValue;\n\t\t\t\t\t\t\tthis.changeEmitter.emit(eventID);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn row;\n\t\t});\n\n\t\tthis.setNumPaladins(raidSimUI.getClassCount(Class.ClassPaladin));\n\t\traidSimUI.compChangeEmitter.on(eventID => {\n\t\t\tthis.setNumPaladins(raidSimUI.getClassCount(Class.ClassPaladin));\n\t\t});\n\t}\n\n\tprivate setNumPaladins(numPaladins: number) {\n\t\tnumPaladins = Math.min(numPaladins, MAX_PALADINS);\n\n\t\tfor (let i = 0; i < numPaladins; i++) {\n\t\t\tthis.cols[i].forEach(elem => elem.classList.add('paladin-active'));\n\t\t}\n\t\tfor (let i = numPaladins; i < MAX_PALADINS; i++) {\n\t\t\tthis.cols[i].forEach(elem => elem.classList.remove('paladin-active'));\n\t\t}\n\t}\n\n\tgetAssignments(): BlessingsAssignments {\n\t\t// Defensive copy.\n\t\treturn BlessingsAssignments.clone(this.assignments);\n\t}\n\n\tsetAssignments(eventID: EventID, newAssignments: BlessingsAssignments) {\n\t\tthis.assignments = BlessingsAssignments.clone(newAssignments);\n\t\tthis.changeEmitter.emit(eventID);\n\t}\n}\n","import { Exporter } from '../core/components/exporters.js';\nimport { Importer } from '../core/components/importers.js';\nimport { MAX_PARTY_SIZE } from '../core/party.js';\nimport { BuffBot, RaidSimSettings } from '../core/proto/ui.js';\nimport { TypedEvent } from '../core/typed_event.js';\nimport { Party as PartyProto, Player as PlayerProto, Raid as RaidProto } from '../core/proto/api.js';\nimport { Encounter as EncounterProto, EquipmentSpec, ItemSpec, MobType, Spec, Target as TargetProto, RaidTarget, Faction } from '../core/proto/common.js';\nimport { nameToClass } from '../core/proto_utils/names.js';\nimport { makeDefaultBlessings, specTypeFunctions, withSpecProto, isTankSpec, playerToSpec } from '../core/proto_utils/utils.js';\nimport { MAX_NUM_PARTIES } from '../core/raid.js';\nimport { Player } from '../core/player.js';\nimport { Target } from '../core/target.js';\n\nimport { playerPresets, PresetSpecSettings } from './presets.js';\nimport { RaidSimUI } from './raid_sim_ui.js';\n\ndeclare var $: any;\ndeclare var tippy: any;\n\nexport function newRaidImporters(simUI: RaidSimUI): HTMLElement {\n\tconst importSettings = document.createElement('div');\n\timportSettings.classList.add('import-settings', 'sim-dropdown-menu');\n\timportSettings.innerHTML = `\n\t\t<span id='importMenuLink' class='dropdown-toggle fas fa-file-import' role='button' data-toggle='dropdown' aria-haspopup='true' arai-expanded='false'></span>\n\t\t<div class='dropdown-menu dropdown-menu-right' aria-labelledby='importMenuLink'>\n\t\t</div>\n\t`;\n\tconst linkElem = importSettings.getElementsByClassName('dropdown-toggle')[0] as HTMLElement;\n\ttippy(linkElem, {\n\t\t'content': 'Import',\n\t\t'allowHTML': true,\n\t});\n\n\tconst menuElem = importSettings.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\tconst addMenuItem = (label: string, experimental: boolean, onClick: () => void) => {\n\t\tconst itemElem = document.createElement('span');\n\t\titemElem.classList.add('dropdown-item');\n\t\titemElem.textContent = label;\n\t\titemElem.addEventListener('click', onClick);\n\t\tmenuElem.appendChild(itemElem);\n\t};\n\n\taddMenuItem('Json', false, () => new RaidJsonImporter(menuElem, simUI));\n\taddMenuItem('WCL', true, () => new RaidWCLImporter(menuElem, simUI));\n\n\treturn importSettings;\n}\n\nexport function newRaidExporters(simUI: RaidSimUI): HTMLElement {\n\tconst exportSettings = document.createElement('div');\n\texportSettings.classList.add('export-settings', 'sim-dropdown-menu');\n\texportSettings.innerHTML = `\n\t\t<span id='exportMenuLink' class='dropdown-toggle fas fa-file-export' role='button' data-toggle='dropdown' aria-haspopup='true' arai-expanded='false'></span>\n\t\t<div class='dropdown-menu dropdown-menu-right' aria-labelledby='exportMenuLink'>\n\t\t</div>\n\t`;\n\tconst linkElem = exportSettings.getElementsByClassName('dropdown-toggle')[0] as HTMLElement;\n\ttippy(linkElem, {\n\t\t'content': 'Export',\n\t\t'allowHTML': true,\n\t});\n\n\tconst menuElem = exportSettings.getElementsByClassName('dropdown-menu')[0] as HTMLElement;\n\tconst addMenuItem = (label: string, onClick: () => void) => {\n\t\tconst itemElem = document.createElement('span');\n\t\titemElem.classList.add('dropdown-item');\n\t\titemElem.textContent = label;\n\t\titemElem.addEventListener('click', onClick);\n\t\tmenuElem.appendChild(itemElem);\n\t};\n\n\taddMenuItem('Json', () => new RaidJsonExporter(menuElem, simUI));\n\n\treturn exportSettings;\n}\n\nclass RaidJsonImporter extends Importer {\n\tprivate readonly simUI: RaidSimUI;\n\tconstructor(parent: HTMLElement, simUI: RaidSimUI) {\n\t\tsuper(parent, 'JSON Import', true);\n\t\tthis.simUI = simUI;\n\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport settings from a JSON text file, which can be created using the JSON Export feature of this site.\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the JSON text below and click, 'Import'.\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tonImport(data: string) {\n\t\tconst settings = RaidSimSettings.fromJsonString(data);\n\t\tthis.simUI.fromProto(TypedEvent.nextEventID(), settings);\n\t\tthis.close();\n\t}\n}\n\nclass RaidJsonExporter extends Exporter {\n\tprivate readonly simUI: RaidSimUI;\n\n\tconstructor(parent: HTMLElement, simUI: RaidSimUI) {\n\t\tsuper(parent, 'JSON Export', true);\n\t\tthis.simUI = simUI;\n\t\tthis.init();\n\t}\n\n\tgetData(): string {\n\t\treturn JSON.stringify(RaidSimSettings.toJson(this.simUI.toProto()), null, 2);\n\t}\n}\n\nclass RaidWCLImporter extends Importer {\n\n\tprivate queryCounter: number = 0;\n\n\tprivate readonly simUI: RaidSimUI;\n\tconstructor(parent: HTMLElement, simUI: RaidSimUI) {\n\t\tsuper(parent, 'WCL Import', false);\n\t\tthis.simUI = simUI;\n\t\tthis.descriptionElem.innerHTML = `\n\t\t\t<p>\n\t\t\t\tImport entire raid from a WCL report.<br>\n\t\t\t\tParties are a best guess based on buffs.<br>\n\t\t\t\tDouble check innervate/PI and paladin buffs in the settings after import.<br>\n\t\t\t\tDoes not support fight=last currently (will default any non-numeric fight ID to be 0)<br>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\tTo import, paste the WCL report and fight link (https://classic.warcraftlogs.com/reports/REPORTID#fight=FIGHTID).<br>\n\t\t\t\tInclude the fight ID or else first found fight will be used.<br>\n\t\t\t</p>\n\t\t`;\n\t}\n\n\tprivate getWCLBearerToken(): Promise<string> {\n\n\t\treturn fetch('https://classic.warcraftlogs.com/oauth/token', {\n\t\t\t'method': 'POST',\n\t\t\t'headers': {\n\t\t\t\t'Authorization': 'Basic ' + btoa('963d31c8-7efa-4dde-87cf-1b254a8a2f8c:lRJVhujEEnF96xfUoxVHSpnqKN9v8bTqGEjutsO3'),\n\t\t\t},\n\t\t\tbody: new URLSearchParams({\n\t\t\t\t'grant_type': 'client_credentials',\n\t\t\t}),\n\t\t}).then(response => response.json())\n\t\t\t.then(res => res.access_token)\n\t\t\t.catch(err => { // TODO: handle error\n\t\t\t\tconsole.error(err);\n\t\t\t});\n\t}\n\n\tprivate queryWCL(query: string, token: string): Promise<any> {\n\t\tconst headers = {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'Authorization': `Bearer ${token}`,\n\t\t\t'Accept': 'application/json',\n\t\t};\n\n\t\tconst queryURL = `https://classic.warcraftlogs.com/api/v2/client?query=${query}`;\n\n\t\tthis.queryCounter++;\n\n\t\t// Query WCL\n\t\treturn fetch(encodeURI(queryURL), {\n\t\t\t'method': 'GET',\n\t\t\t'headers': headers,\n\t\t}).then(res => res.json());\n\t}\n\n\tprivate getURLInfo(url: string): { reportID: string; fightID: string } {\n\n\t\tlet urlInfo = { reportID: '', fightID: '0' };\n\n\t\tif (!url.includes('warcraftlogs.com')) {\n\t\t\tconsole.error('Invalid WCL URL', url, 'must be from warcraftlogs.com');\n\t\t\treturn urlInfo;\n\t\t}\n\n\t\tlet fightIDIndex = url.indexOf('fight=');\n\t\tlet reportIDIndex = url.indexOf('/reports/');\n\n\t\tif (reportIDIndex === -1) {\n\t\t\tconsole.error('Could not find report ID in URL', url);\n\t\t\treturn urlInfo;\n\t\t}\n\n\t\treportIDIndex += 9; // 9 = length of '/reports/'\n\t\tconst reportIDLength = 16;\n\n\t\tif (fightIDIndex !== -1) {\n\t\t\tfightIDIndex += 6; // 6 = length of 'fight='\n\n\t\t\tlet fightID = parseInt(url.substring(fightIDIndex), 10);\n\n\t\t\tif (isNaN(fightID)) {\n\t\t\t\tfightID = 0;\n\t\t\t}\n\n\t\t\turlInfo.fightID = fightID.toString();\n\t\t} else {\n\t\t\tconsole.warn('Could not find fight ID in URL', url, 'defaulting to fight 0');\n\t\t}\n\n\t\turlInfo.reportID = url.substring(reportIDIndex, reportIDIndex + reportIDLength) ?? '';\n\n\t\treturn urlInfo\n\t}\n\n\tprivate getRateLimit(token: string): Promise<wclRateLimitData> {\n\t\tconst query = `\n\t  {\n\t    rateLimitData {\n\t      limitPerHour, pointsSpentThisHour, pointsResetIn\n\t    }\n\t  }`;\n\t\treturn this.queryWCL(query, token)\n\t\t\t.then((res) => res['data']['rateLimitData'] as wclRateLimitData);\n\t}\n\n\tasync onImport(importLink: string) {\n\t\tthis.importButton.disabled = true;\n\t\tthis.rootElem.style.cursor = 'wait';\n\t\tthis.doImport(importLink).then(() => {\n\t\t\tthis.importButton.disabled = false\n\t\t\tthis.rootElem.style.removeProperty('cursor');\n\t\t})\n\t}\n\n\tasync doImport(importLink: string) {\n\t\tif (!importLink.length) {\n\t\t\tconsole.error('No import link provided!');\n\t\t\treturn;\n\t\t}\n\n\t\tlet urlInfo = this.getURLInfo(importLink);\n\n\t\tconst reportID = urlInfo.reportID;\n\t\tconst fightID = urlInfo.fightID;\n\n\t\tif (!reportID.length) {\n\t\t\tconsole.error('Could not find report ID in URL', importLink);\n\t\t\treturn;\n\t\t}\n\n\t\t// Clear the raid out to avoid any taint issues.\n\t\tthis.simUI.clearRaid(TypedEvent.nextEventID());\n\n\t\tconst token = await this.getWCLBearerToken();\n\n\t\tconst rateLimitBuffer = 30; // WCL Query point buffer\n\t\tconst rateLimitStart: wclRateLimitData = await this.getRateLimit(token);\n\n\t\t// Slower but more accurate way to generate the raid sim.\n\t\t// Generates players into the groups that they were in during the fight.\n\t\t// If the rate limit is close to max, then it will create the raid parties 'randomly'.\n\t\tlet experimentalGenerateParties: boolean = rateLimitStart.pointsSpentThisHour + rateLimitBuffer < rateLimitStart.limitPerHour;\n\n\t\tconsole.info('Importing WCL report', reportID, 'fight', fightID, 'Generate Parties:', experimentalGenerateParties);\n\n\t\tconst reportDataQuery = `\n\t\t\t\t{\n\t\t\t\t\treportData {\n\t\t\t\t\t\treport(code: \"${reportID}\") {\n\t\t\t\t\t\t\tguild {\n\t\t\t\t\t\t\t\tname faction {id}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tplayerDetails: table(fightIDs: [${fightID}], endTime: 99999999, dataType: Casts, killType: All, viewBy: Default)\n\t\t\t\t\t\t\tfights(fightIDs: [${fightID}]) {\n\t\t\t\t\t\t\t\tstartTime, endTime, id, name\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tinnervates: table(fightIDs: [${fightID}], dataType:Casts, endTime: 99999999, sourceClass: \"Druid\", abilityID: 29166),\n\t\t\t\t\t\t\tpowerInfusion: table(fightIDs: [${fightID}], dataType:Casts, endTime: 99999999, sourceClass: \"Priest\", abilityID: 10060)\n\t\t\t\t\t\t\ttricksOfTheTrade: table(fightIDs: [${fightID}], dataType:Casts, endTime: 99999999, sourceClass: \"Rogue\", abilityID: 57933)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t`;\n\n\t\tconst reportData = await this.queryWCL(reportDataQuery, token);\n\t\tif (reportData.errors != undefined && reportData.errors != null && reportData.errors.length) {\n\t\t\tconst errorData = reportData.errors.reduce((accumulator: string, error: any) => {\n\t\t\t\treturn accumulator + error.message;\n\t\t\t}, \"\");\n\t\t\talert(\"Failed to import: \" + errorData);\n\t\t\treturn;\n\t\t}\n\t\t// Process the report data.\n\t\tconst wclData = reportData.data.reportData.report; // TODO: Typings?\n\n\t\tconst guildData = wclData.guild;\n\t\tconst playerData: wclPlayer[] = wclData.playerDetails.data.entries;\n\t\tconst innervateData: wclBuffCastsData[] = wclData.innervates.data.entries;\n\t\tconst powerInfusionData: wclBuffCastsData[] = wclData.powerInfusion.data.entries;\n\t\tconst tricksOfTheTradeData: wclBuffCastsData[] = wclData.tricksOfTheTrade.data.entries;\n\n\t\t// Set up the general variables we need for import to be successful.\n\t\tconst fight: { startTime: number, endTime: number, id: number, name: string } = wclData.fights[0];\n\t\tconst startTime: number = fight.startTime;\n\t\tconst endTime: number = fight.endTime;\n\n\t\t// Default to UI setting\n\t\tlet faction = this.simUI.raidPicker?.getCurrentFaction();\n\n\t\t// If defined in log, use that faction.\n\t\tif (guildData != null) {\n\t\t\tfaction = guildData.faction.id as Faction;\n\t\t}\n\n\t\t// Fallback if UI is broken and log has no faction.\n\t\tif (faction == undefined) {\n\t\t\tfaction = Faction.Horde;\n\t\t}\n\n\t\tconst encounter = EncounterProto.create();\n\t\tencounter.duration = (endTime - startTime) / 1000;\n\n\t\tencounter.targets = new Array<TargetProto>();\n\n\t\tlet closestEncounterPreset = this.simUI.sim.getAllPresetEncounters().find((enc) => enc.path.includes(fight.name));\n\n\t\t// Use the preset encounter if it exists.\n\t\tif (closestEncounterPreset && closestEncounterPreset.targets.length) {\n\t\t\tclosestEncounterPreset.targets\n\t\t\t\t.map((mob) => mob.target as TargetProto)\n\t\t\t\t.filter((target) => target !== undefined)\n\t\t\t\t.forEach((target) => encounter.targets.push(target));\n\t\t}\n\n\t\t// Build a manual target list if no preset encounter exists.\n\t\tif (encounter.targets.length === 0) {\n\t\t\tencounter.targets.push(Target.defaultProto());\n\t\t}\n\n\t\tconst settings = RaidSimSettings.create();\n\t\tsettings.encounter = encounter;\n\n\t\tconst raid = RaidProto.create();\n\t\traid.parties = new Array<PartyProto>();\n\t\tsettings.raid = raid;\n\n\t\tconst buffBots = new Array<BuffBot>();\n\n\t\t// Raid index of players that received innervates\n\t\tconst wclIDtoRaidIndex = new Map<number, number>();\n\n\t\tconst numPaladins = playerData.filter((player) => player.type === 'Paladin').length;\n\n\t\t// Generate an empty set of 3 dimensional arrays for each party. [ party ][ player or buffBot ][ player ]\n\t\tlet tempParties: WCLSimPlayer[][] = Array.from({ length: MAX_NUM_PARTIES }).map(() => []);\n\n\t\t// Generate the default 5 raid parties & temp parties.\n\t\ttempParties.forEach(() => raid.parties.push(PartyProto.create()));\n\n\t\t// Sorts an objectArray by a property. Returns a new array.\n\t\t// Can be called recursively.\n\t\tconst sortByProperty = (objArray: any[], prop: string) => {\n\t\t\tif (!Array.isArray(objArray)) throw new Error('FIRST ARGUMENT NOT AN ARRAY');\n\t\t\tconst clone = objArray.slice(0);\n\t\t\tconst direct = arguments.length > 2 ? arguments[2] : 1; //Default to ascending\n\t\t\tconst propPath = (prop.constructor === Array) ? prop : prop.split('.');\n\t\t\tclone.sort(function(a, b) {\n\t\t\t\tfor (let p in propPath) {\n\t\t\t\t\tif (a[propPath[p]] && b[propPath[p]]) {\n\t\t\t\t\t\ta = a[propPath[p]];\n\t\t\t\t\t\tb = b[propPath[p]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// convert numeric strings to integers\n\t\t\t\ta = a.toString().match(/^\\d+$/) ? +a : a;\n\t\t\t\tb = b.toString().match(/^\\d+$/) ? +b : b;\n\t\t\t\treturn ((a < b) ? -1 * direct : ((a > b) ? 1 * direct : 0));\n\t\t\t});\n\t\t\treturn clone;\n\t\t}\n\n\t\tconst mappedPlayers = playerData\n\t\t\t.map((wclPlayer) => new WCLSimPlayer(wclPlayer, this.simUI, faction));\n\n\t\tconst processBuffCastData = (buffCastData: wclBuffCastsData[]): { player: WCLSimPlayer, target: string }[] => {\n\t\t\tconst playerCasts: { player: WCLSimPlayer, target: string }[] = [];\n\t\t\tif (buffCastData.length) {\n\t\t\t\tbuffCastData.forEach((cast) => {\n\t\t\t\t\tconst sourcePlayer = mappedPlayers.find((player) => player.name === cast.name);\n\t\t\t\t\tconst targetPlayer = mappedPlayers.find((player) => player.name === cast.targets[0].name);\n\n\t\t\t\t\t// Buff bots do not get PI/Innervates.\n\t\t\t\t\tif (sourcePlayer && targetPlayer && !targetPlayer.isBuffBot) {\n\t\t\t\t\t\tplayerCasts.push({ player: sourcePlayer, target: targetPlayer.name });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn playerCasts;\n\t\t}\n\n\t\tprocessBuffCastData(innervateData).forEach((cast) => cast.player.innervateTarget = cast.target);\n\t\tprocessBuffCastData(powerInfusionData).forEach((cast) => cast.player.powerInfusionTarget = cast.target);\n\t\tprocessBuffCastData(tricksOfTheTradeData).forEach((cast) => cast.player.tricksOfTheTradeTarget = cast.target);\n\n\t\tconst wclPlayers: WCLSimPlayer[] = sortByProperty(sortByProperty(mappedPlayers, 'type'), 'sortPriority');\n\n\t\tlet raidIndex = 0;\n\n\t\t// Sorts buff bots to the end of the array to prevent overwriting them later on.\n\t\tconst sortBuffBotsLast = (a: WCLSimPlayer, b: WCLSimPlayer) => a.isBuffBot ? 1 : b.isBuffBot ? 1 : 0;\n\n\t\t// Reusable function to add a player to the raid.parties[raidIndex] array.\n\t\tconst assignPlayerToParty = (player: WCLSimPlayer, raidParty: PartyProto, missing = false) => {\n\n\t\t\tif (!player) {\n\t\t\t\tconsole.error('Cannot assign player to party because player is undefined!');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!raidParty) {\n\t\t\t\tconsole.error('Cannot assign player to party because party is undefined!');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (raidParty.players.length === MAX_PARTY_SIZE) {\n\t\t\t\tconsole.error('Cannot assign player to party because party is full!', player, raidParty.players);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (missing) {\n\t\t\t\tconsole.warn(`Could not locate a group for ${player.name}, assigning them to an open group.`);\n\t\t\t}\n\n\t\t\tlet buffBot = player.getBuffBot();\n\t\t\tlet simPlayer = player.getPlayer();\n\n\t\t\tif (!buffBot && !simPlayer) {\n\t\t\t\tconsole.error('Cannot assign player to party because player data is undefined!', player);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twclIDtoRaidIndex.set(player.id, raidIndex);\n\n\t\t\tif (buffBot) {\n\t\t\t\tbuffBot.raidIndex = raidIndex;\n\t\t\t\tbuffBots.push(buffBot);\n\t\t\t\traidParty.players.push(PlayerProto.create());\n\t\t\t} else if (simPlayer) {\n\t\t\t\traidParty.players.push(simPlayer);\n\t\t\t\tif (isTankSpec(playerToSpec(simPlayer))) {\n\t\t\t\t\tlet rt = RaidTarget.create();\n\t\t\t\t\trt.targetIndex = wclIDtoRaidIndex.get(player.id)!;\n\t\t\t\t\tsettings.raid!.tanks.push(rt);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Just in case this did not get set previously.\n\t\t\tplayer.partyAssigned = true;\n\n\t\t\traidIndex++;\n\t\t}\n\n\t\t// if experimental_generate_parties is true, we will generate parties based on the party buffers\n\t\tif (experimentalGenerateParties) {\n\n\t\t\t// We only care about the players who can provide party buffs on logs.\n\t\t\tconst partyBuffPlayers = wclPlayers.filter((player) => player.isPartyBuffer);\n\n\t\t\t// Can't be a forEach because we need to wait for the query to finish on each iteration later on.\n\t\t\tfor (const player of partyBuffPlayers) {\n\n\t\t\t\tconst partyFull = player.partyMembers.length >= MAX_PARTY_SIZE;\n\n\t\t\t\t// Skip players that have already been assigned to a party.\n\t\t\t\t// player.partyAssigned || player.partyFound || player.partyMembers.length > 0\n\t\t\t\tif (partyFull) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst auraIDs: number[] = player.getPartyAuraIds();\n\n\t\t\t\tif (!auraIDs.length) {\n\t\t\t\t\tconsole.warn('No party aura ids found for partyBuff player ' + player.name);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet auraBuffQueries = auraIDs.map((auraID) => `\n\t\t\t\t{\n\t\t\t\t\treportData {\n\t\t\t\t\t\treport(code: \"${reportID}\") {\n\t\t\t\t\ttable(startTime: ${startTime}, endTime: ${endTime}, sourceID: ${player.id}, abilityID: ${auraID}, fightIDs: [${fightID}],dataType:Buffs,viewBy:Target,hostilityType:Friendlies)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}`);\n\n\t\t\t\tlet auraTargets: wclAura[] = [];\n\n\t\t\t\t// Can't be a forEach because we need to await each query.\n\t\t\t\tfor (let i = 0; i < auraBuffQueries.length; i++) {\n\n\t\t\t\t\tif (auraTargets.length >= MAX_PARTY_SIZE || partyFull) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet auraQueryRes = await this.queryWCL(auraBuffQueries[i], token);\n\t\t\t\t\tif (auraQueryRes) {\n\t\t\t\t\t\tlet playerAuras: wclAura[] = auraQueryRes.data?.reportData?.report?.table?.data?.auras ?? [];\n\t\t\t\t\t\tif (playerAuras.length) {\n\n\t\t\t\t\t\t\tplayerAuras = playerAuras.filter((auraTarget) => auraTarget.type !== 'Pet')\n\t\t\t\t\t\t\t\t.sort((a, b) => a.bands[0].startTime - b.bands[0].startTime)\n\t\t\t\t\t\t\t\t.filter((auraTarget, index) => index < 5);\n\n\t\t\t\t\t\t\tconst uniqueAuraTargets = playerAuras.filter((auraTarget) => !auraTargets.some((target) => target.name === auraTarget.name));\n\t\t\t\t\t\t\tauraTargets.push(...uniqueAuraTargets);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (auraTargets.length === 0) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tplayer.partyFound = true;\n\n\t\t\t\t// Only need the member names at this point.\n\t\t\t\tplayer.partyMembers = auraTargets.map((auraTarget) => auraTarget.name);\n\n\t\t\t\tlet partyMembers = wclPlayers\n\t\t\t\t\t.filter((raidMember) => player.partyMembers.includes(raidMember.name))\n\t\t\t\t\t.filter((raidMember) => !raidMember.partyAssigned);\n\n\t\t\t\tconst totalPartyMembers = partyMembers.length;\n\n\t\t\t\t// Find an empty temp party to assign the members to.\n\t\t\t\tlet partyIndex: number = tempParties.findIndex((party) => party.length < MAX_PARTY_SIZE && party.length < totalPartyMembers);\n\n\t\t\t\t// Try and see if any of the parties have your party members in it without you.\n\t\t\t\tif (partyIndex === -1) {\n\t\t\t\t\tconsole.warn('No empty temp party found for player ' + player.name);\n\t\t\t\t\tpartyIndex = tempParties\n\t\t\t\t\t\t.filter((party) => party.length < MAX_PARTY_SIZE)\n\t\t\t\t\t\t.findIndex((party) => party.some((member) => player.partyMembers.includes(member.name)));\n\t\t\t\t\tconsole.info('Found party with members in it: ' + partyIndex);\n\t\t\t\t}\n\n\t\t\t\tlet party: WCLSimPlayer[] = tempParties[partyIndex];\n\n\t\t\t\tpartyMembers.forEach((partyMember) => {\n\n\t\t\t\t\tconst isUndefined = party === undefined;\n\t\t\t\t\tconst isFull = party.length === MAX_PARTY_SIZE;\n\n\t\t\t\t\tif (isUndefined || isFull) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tpartyMember.partyAssigned = true;\n\t\t\t\t\tpartyMember.partyMembers = player.partyMembers;\n\n\t\t\t\t\tparty.push(partyMember);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Process the temp groups into the sim raid groups.\n\t\t\ttempParties.forEach((party, partyIndex) => {\n\n\t\t\t\tlet raidParty = raid.parties[partyIndex];\n\n\t\t\t\tparty\n\t\t\t\t\t.sort(sortBuffBotsLast)\n\t\t\t\t\t.forEach((player) => assignPlayerToParty(player, raidParty));\n\t\t\t});\n\t\t}\n\n\t\t// Process the players who didn't get assigned a group yet.\n\t\twclPlayers\n\t\t\t.filter((player) => !player.partyAssigned)\n\t\t\t.sort(sortBuffBotsLast)\n\t\t\t.map((player) => {\n\t\t\t\tlet raidParty = raid.parties.filter((party) => party.players.length < MAX_PARTY_SIZE)[0];\n\t\t\t\tassignPlayerToParty(player, raidParty, true);\n\t\t\t});\n\n\t\t// Insert the innervate / PI buffs into the options for the raid.\n\t\twclPlayers\n\t\t\t.filter((player) => player.innervateTarget || player.powerInfusionTarget || player.tricksOfTheTradeTarget)\n\t\t\t.forEach((player) => {\n\n\t\t\t\tconst target: wclSimPlayer | undefined = wclPlayers.find((wclPlayer) => wclPlayer.name === player.innervateTarget || player.name === player.powerInfusionTarget || player.name === player.tricksOfTheTradeTarget);\n\n\t\t\t\tif (!target) {\n\t\t\t\t\tconsole.warn('Could not find target assignment player');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst targetID: number = target.id;\n\t\t\t\tconst targetRaidIndex: number | undefined = wclIDtoRaidIndex.get(targetID);\n\n\t\t\t\tif (!targetRaidIndex) {\n\t\t\t\t\tconsole.warn(`Could not find ${target.name} raid index!`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (player.isBuffBot) {\n\t\t\t\t\tconst playerID: number = player.id;\n\t\t\t\t\tconst playerRaidIndex: number | undefined = wclIDtoRaidIndex.get(playerID);\n\t\t\t\t\tconst buffBot = buffBots.find((buffBot) => buffBot.raidIndex === playerRaidIndex);\n\t\t\t\t\tif (buffBot) {\n\t\t\t\t\t\tif (player.innervateTarget) {\n\t\t\t\t\t\t\tbuffBot.innervateAssignment = RaidTarget.create();\n\t\t\t\t\t\t\tbuffBot.innervateAssignment.targetIndex = targetRaidIndex\n\t\t\t\t\t\t} else if (player.powerInfusionTarget) {\n\t\t\t\t\t\t\tbuffBot.powerInfusionAssignment = RaidTarget.create();\n\t\t\t\t\t\t\tbuffBot.powerInfusionAssignment.targetIndex = targetRaidIndex\n\t\t\t\t\t\t} else if (player.tricksOfTheTradeTarget) {\n\t\t\t\t\t\t\tbuffBot.tricksOfTheTradeAssignment = RaidTarget.create();\n\t\t\t\t\t\t\tbuffBot.tricksOfTheTradeAssignment.targetIndex = targetRaidIndex\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Regular players.\n\n\t\t\t\tconst raidParty = raid.parties.filter((party) => party.players.some((raidPlayer) => raidPlayer.name === player.name))[0];\n\n\t\t\t\tif (!raidParty) {\n\t\t\t\t\tconsole.warn('Could not find raiding party for player ' + player.name);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst raidPlayer = raidParty.players.find((raidPlayer) => raidPlayer.name === player.name);\n\n\t\t\t\tif (!raidPlayer) {\n\t\t\t\t\tconsole.warn('Could not find raid player ' + player.name + ' in raid party ' + raidParty);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (player.innervateTarget) {\n\t\t\t\t\tif (raidPlayer.spec.oneofKind == 'balanceDruid') {\n\t\t\t\t\t\traidPlayer.spec.balanceDruid.options!.innervateTarget = RaidTarget.create();\n\t\t\t\t\t\traidPlayer.spec.balanceDruid.options!.innervateTarget.targetIndex = targetRaidIndex;\n\t\t\t\t\t} else if (raidPlayer.spec.oneofKind == 'feralDruid') {\n\t\t\t\t\t\traidPlayer.spec.feralDruid.options!.innervateTarget = RaidTarget.create();\n\t\t\t\t\t\traidPlayer.spec.feralDruid.options!.innervateTarget.targetIndex = targetRaidIndex;\n\t\t\t\t\t} else if (raidPlayer.spec.oneofKind == 'feralTankDruid') {\n\t\t\t\t\t\traidPlayer.spec.feralTankDruid.options!.innervateTarget = RaidTarget.create();\n\t\t\t\t\t\traidPlayer.spec.feralTankDruid.options!.innervateTarget.targetIndex = targetRaidIndex;\n\t\t\t\t\t}\n\t\t\t\t} else if (player.powerInfusionTarget) {\n\t\t\t\t\t// Pretty sure there is no shadow priest that has PI\n\t\t\t\t} else if (player.tricksOfTheTradeTarget) {\n\t\t\t\t\t// TODO: I'm not sure what I'm supposed to do here\n\t\t\t\t}\n\t\t\t});\n\n\t\twclPlayers\n\t\t\t.filter((player) => !player.partyAssigned)\n\t\t\t.forEach((player) => {\n\t\t\t\tconsole.error(`${player.name} is not in a party!`, player);\n\t\t\t});\n\n\t\tsettings.blessings = makeDefaultBlessings(numPaladins);\n\n\t\tthis.simUI.fromProto(TypedEvent.nextEventID(), settings);\n\t\tthis.simUI.setBuffBots(TypedEvent.nextEventID(), buffBots);\n\n\t\tif (!experimentalGenerateParties) {\n\t\t\tconst rateLimitEnd: wclRateLimitData = await this.getRateLimit(token);\n\t\t\tconsole.debug(`Rate Limit resets in ${rateLimitEnd.pointsResetIn} seconds.`);\n\t\t}\n\n\t\tthis.close();\n\t}\n}\n\nclass WCLSimPlayer implements wclSimPlayer {\n\tpublic gear: wclGear[];\n\tpublic icon: string;\n\tpublic id: number;\n\tpublic name: string;\n\tpublic type: string;\n\tpublic talents: wclTalents[];\n\tpublic wclSpec: string;\n\n\tpublic partyAssigned: boolean = false;\n\tpublic partyFound: boolean = false;\n\tpublic partyMembers: string[] = [];\n\n\tpublic isPartyBuffer: boolean = false;\n\tpublic isBuffBot: boolean = false;\n\tpublic sortPriority: number = 99;\n\n\tpublic innervateTarget: string | undefined;\n\tpublic powerInfusionTarget: string | undefined;\n\tpublic tricksOfTheTradeTarget: string | undefined;\n\n\tprivate simUI: RaidSimUI;\n\tprivate spec: Spec;\n\tprivate specType: string;\n\tprivate faction: Faction;\n\n\tconstructor(data: wclPlayer, simUI: RaidSimUI, faction: Faction = Faction.Unknown) {\n\t\tthis.simUI = simUI;\n\n\t\tthis.name = data.name;\n\t\tthis.gear = data.gear;\n\t\tthis.icon = data.icon;\n\t\tthis.id = data.id;\n\t\tthis.type = data.type;\n\t\tthis.talents = data.talents;\n\t\tthis.wclSpec = data.icon.split('-')[1];\n\t\tthis.faction = faction;\n\n\t\t// Prot Paladin's occasionally have a specType of 'Protection' instead of 'Justicar'?\n\t\tif (this.type === 'Paladin' && this.wclSpec === 'Protection') {\n\t\t\tthis.wclSpec = 'Justicar';\n\t\t}\n\n\t\tthis.spec = specNames[this.wclSpec];\n\t\tthis.specType = this.wclSpec + this.type;\n\n\t\tthis.isBuffBot = this.spec === undefined;\n\n\t\tthis.isPartyBuffer = this.getPartyAuraIds().length > 1;\n\n\t\tthis.sortPriority = specSortPriority[this.wclSpec] ?? 99;\n\t}\n\n\tpublic getPlayer(): PlayerProto | undefined {\n\n\t\tif (this.isBuffBot) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet player = PlayerProto.create();\n\n\t\tconst specFuncs = specTypeFunctions[this.spec];\n\n\t\tconst matchingPreset = this.getMatchingPreset();\n\n\t\tif (matchingPreset === undefined) {\n\t\t\tconsole.error('Could not find matching preset for non buff bot', {\n\t\t\t\t'name': this.name,\n\t\t\t\t'spec': this.spec,\n\t\t\t\t'type': this.type,\n\t\t\t\t'talents': this.talents,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tplayer = withSpecProto(this.spec, player, matchingPreset.rotation, specFuncs.talentsCreate(), matchingPreset.specOptions);\n\n\t\tplayer.talentsString = matchingPreset.talents.talentsString;\n\t\tplayer.glyphs = matchingPreset.talents.glyphs;\n\t\tplayer.consumes = matchingPreset.consumes;\n\n\t\tplayer.name = this.name;\n\t\tplayer.class = nameToClass(this.type);\n\t\tplayer.equipment = this.getEquipment();\n\t\tplayer.race = matchingPreset.defaultFactionRaces[this.faction];\n\n\t\tPlayer.applySharedDefaultsToProto(player);\n\n\t\treturn player;\n\t}\n\n\tpublic getBuffBot(): BuffBot | undefined {\n\n\t\tif (!this.isBuffBot) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst botID = buffBotNames[this.specType];\n\n\t\tif (botID == null) {\n\t\t\tconsole.error('Buff Bot Spec not implemented: ', this.specType);\n\t\t\treturn;\n\t\t}\n\n\t\tconst bot = BuffBot.create();\n\t\tbot.id = botID;\n\t\tbot.raidIndex = -1; // Default it for now. // numPlayers\n\n\t\treturn bot;\n\t}\n\n\tpublic getPartyAuraIds() {\n\n\t\tconst allSpecClassAuras: any = {\n\t\t\t'Paladin': [\n\t\t\t\t19746, // Concentration Aura\n\t\t\t\t27149, // Devotion Aura,\n\t\t\t\t27150, // Retribution Aura\n\t\t\t],\n\t\t\t'Warrior': [\n\t\t\t\t2048,  // Battle Shout\n\t\t\t\t469, // Commanding Shout\n\t\t\t],\n\t\t\t'Warlock': [\n\t\t\t\t27268, // Pet Imp: Blood Pact\n\t\t\t\t18696, // Improved Imp: Blood Pact\n\t\t\t],\n\t\t};\n\n\t\t// Reused for the plethora of Feral specs.\n\t\tconst feralDruidSpecAuras = [\n\t\t\t24932, // Improved Leader of the Pack // at least 0,32,0\n\t\t\t// 17007, // Leader of the Pack // at least 0,31,0\n\t\t];\n\n\t\t// TODO: Could additionally filter out buff IDs based on minimum req talent strings?\n\t\tconst specSpecificAuras: any = {\n\t\t\t'RetributionPaladin': [\n\t\t\t\t20092, // Improved Retribution Aura // at least 0,0,16\n\t\t\t\t20218, // Sanctity Aura // at least 0,0,21\n\t\t\t\t31870, // Improved Sanctity Aura // at least 0,0,22\n\t\t\t],\n\t\t\t'GuardianDruid': [...feralDruidSpecAuras],\n\t\t\t'WardenDruid': [...feralDruidSpecAuras],\n\t\t\t'FeralDruid': [...feralDruidSpecAuras],\n\t\t\t'BalanceDruid': [\n\t\t\t\t24907, // Moonkin Aura // at least 31,0,0\n\t\t\t],\n\t\t\t'RestorationDruid': [\n\t\t\t\t34123, // Tree of Life // at least 0,0,41\n\t\t\t],\n\t\t\t'MarksmanHunter': [\n\t\t\t\t27066, // Trueshot Aura // at least 0,32,0\n\t\t\t],\n\t\t\t'EnhancementShaman': [\n\t\t\t\t30811, // Unleashed Rage // at least 0,36,0\n\t\t\t],\n\t\t\t// 'ElementalShaman': [] // Totem buffs do not show up in logs. Leaving for future reference.\n\t\t};\n\n\t\tconst consumableAuras = [\n\t\t\t351355, // Greater Drums of Battle\n\t\t];\n\n\t\tconst classAuras = allSpecClassAuras[this.type] ?? [];\n\t\tconst specAuras = specSpecificAuras[this.specType] ?? [];\n\n\t\tconst reliableAuras = [\n\t\t\t...specAuras, ...classAuras, ...consumableAuras,\n\t\t];\n\n\t\tif (this.type === 'Shaman') {\n\t\t\t// Shamans get moved around a lot, so Heroism isn't a good reference for what group they are in.\n\t\t\treturn [\n\t\t\t\t...reliableAuras,\n\t\t\t\t32182, // Heroism\n\t\t\t];\n\t\t}\n\t\treturn reliableAuras;\n\t}\n\n\tprivate getMatchingPreset(): PresetSpecSettings<Spec> {\n\t\tconst matchingPresets = playerPresets.filter((preset) => preset.spec === this.spec);\n\t\tlet presetIdx = 0;\n\n\t\tif (matchingPresets && matchingPresets.length > 1) {\n\t\t\tlet distance = 100;\n\t\t\t// Search talents and find the preset that the players talents most closely match.\n\t\t\tmatchingPresets.forEach((preset, i) => {\n\t\t\t\tlet presetTalents = [0, 0, 0];\n\t\t\t\tlet talentIdx = 0;\n\t\t\t\t// First sum up the number of talents per tree for preset.\n\t\t\t\tArray.from(preset.talents.talentsString).forEach((v) => {\n\t\t\t\t\tif (v == '-') {\n\t\t\t\t\t\ttalentIdx++;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tpresetTalents[talentIdx] += parseInt(v);\n\t\t\t\t});\n\n\t\t\t\t// Diff the distance to the preset.\n\n\t\t\t\tconst newDistance = presetTalents.reduce((acc, v, i) => acc += Math.abs(this.talents[i]?.guid - presetTalents[i]), 0);\n\n\t\t\t\t// If this is the best distance, assign this preset.\n\t\t\t\tif (newDistance < distance) {\n\t\t\t\t\tpresetIdx = i;\n\t\t\t\t\tdistance = newDistance;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn matchingPresets[presetIdx];\n\t}\n\n\tprivate getEquipment(): EquipmentSpec {\n\t\tlet equipment = EquipmentSpec.create();\n\t\tequipment.items = new Array<ItemSpec>();\n\n\t\tthis.gear.forEach((gear) => {\n\t\t\tconst item = ItemSpec.create();\n\t\t\titem.id = gear.id;\n\t\t\tconst dbEnchant = this.simUI.sim.getEnchantFlexible(gear.permanentEnchant);\n\t\t\titem.enchant = dbEnchant\n\t\t\t\t? dbEnchant.id\n\t\t\t\t: 0;\n\t\t\tif (gear.gems) {\n\t\t\t\titem.gems = new Array<number>();\n\t\t\t\tgear.gems.forEach((gemInfo) => item.gems.push(gemInfo.id));\n\t\t\t}\n\t\t\tequipment!.items.push(item);\n\t\t});\n\t\treturn equipment;\n\t}\n\n}\n\n\n// Maps WCL spec to sorting priority for party makeup checks. Lower the number, the more likely the query will be successful.\nconst specSortPriority: Record<string, number> = {\n\t'Warden': 0,\n\t'Guardian': 1,\n\t'Feral': 2,\n\t'Balance': 3,\n\t'Justicar': 4,\n\t'Retribution': 5,\n\t'Fury': 6,\n\t'Arms': 7,\n\t'Protection': 8,\n\t'Enhancement': 9,\n\t'Destruction': 10,\n\t'Affliction': 11,\n\t'Demonology': 12,\n\t'Marksman': 13,\n};\n\n// Maps WCL spec names to internal Spec enum.\nconst specNames: Record<string, Spec> = {\n\t'Balance': Spec.SpecBalanceDruid,\n\t'Elemental': Spec.SpecElementalShaman,\n\t'Enhancement': Spec.SpecEnhancementShaman,\n\t'Feral': Spec.SpecFeralDruid,\n\t'Warden': Spec.SpecFeralTankDruid,\n\t'Guardian': Spec.SpecFeralTankDruid,\n\t'Survival': Spec.SpecHunter,\n\t'BeastMastery': Spec.SpecHunter,\n\t'Arcane': Spec.SpecMage,\n\t'Fire': Spec.SpecMage,\n\t'Frost': Spec.SpecMage,\n\t'Assassination': Spec.SpecRogue,\n\t'Combat': Spec.SpecRogue,\n\t'Retribution': Spec.SpecRetributionPaladin,\n\t'Justicar': Spec.SpecProtectionPaladin,\n\t'Shadow': Spec.SpecShadowPriest,\n\t'Smite': Spec.SpecSmitePriest,\n\t'Destruction': Spec.SpecWarlock,\n\t'Affliction': Spec.SpecWarlock,\n\t'Demonology': Spec.SpecWarlock,\n\t'Arms': Spec.SpecWarrior,\n\t'Fury': Spec.SpecWarrior,\n\t'Champion': Spec.SpecWarrior,\n\t'Warrior': Spec.SpecWarrior,\n\t'Gladiator': Spec.SpecWarrior,\n\t'Protection': Spec.SpecProtectionWarrior,\n};\n\n// Maps WCL spec+type to internal buff bot IDs.\nconst buffBotNames: Record<string, string> = {\n\t// Healers\n\t'HolyPaladin': 'Paladin',\n\t'HolyPriest': 'Holy Priest',\n\t'DisciplinePriest': 'Divine Spirit Priest',\n\t'RestorationDruid': 'Resto Druid',\n\t'DreamstateDruid': 'Resto Druid',\n\t'RestorationShaman': 'Resto Shaman',\n};\n\ninterface wclBuffCastsData {\n\tname: string;\n\ttargets: {\n\t\tname: string;\n\t\ttype: string;\n\t}[];\n}\n\ninterface wclRateLimitData {\n\tlimitPerHour: number,\n\tpointsSpentThisHour: number,\n\tpointsResetIn: number\n}\n\n// Typed interface for WCL talents\ninterface wclTalents {\n\tname: string;\n\tguid: number;\n\ttype: number;\n\tabilityIcon: string;\n}\n\n// Typed interface for WCL Gems\ninterface wclGems {\n\tid: number;\n\titemLevel: number;\n\ticon: string;\n}\n\n// Typed interface for WCL Gear\ninterface wclGear {\n\tid: number;\n\tslot: number;\n\tquality: number;\n\ticon: string;\n\tname: string;\n\titemLevel: number;\n\tpermanentEnchant: number;\n\tpermanentEnchantName: string;\n\ttemporaryEnchant: number;\n\tgems?: wclGems[];\n}\n\n// Typed interface for WCL Player Data\ninterface wclPlayer {\n\tname: string;\n\tid: number;\n\tguid?: number;\n\ttype: string; // Paladin, Mage, etc.\n\ticon: string; // Paladin-Justicar, Mage-Fire, etc.\n\titemLevel?: number;\n\ttotal?: number;\n\tactiveTime?: number;\n\tactiveTimeReduced?: number;\n\tabilities?: unknown[]; // Don't care about abilities.\n\tdamageAbilities?: unknown[];\n\ttargets?: unknown[];\n\ttalents: wclTalents[];\n\tgear: wclGear[];\n}\n\n// Typed interface for WoWSimPlayer class\ninterface wclSimPlayer extends wclPlayer {\n\twclSpec: string;\n\tpartyAssigned: boolean;\n\tisPartyBuffer: boolean;\n\tpartyMembers: string[];\n\tisBuffBot: boolean;\n}\n\ninterface wclAura {\n\tname: string;\n\tid: number;\n\tguid: number;\n\ttype: string;\n\ticon: string;\n\ttotalUptime: number;\n\ttotalUses: number;\n\tbands: {\n\t\tstartTime: number,\n\t\tendTime: number,\n\t}[];\n}\n","import { CloseButton } from '../core/components/close_button.js';\nimport { Component } from '../core/components/component.js';\nimport { EnumPicker } from '../core/components/enum_picker.js';\nimport { makePhaseSelector } from '../core/components/other_inputs.js';\nimport { Raid } from '../core/raid.js';\nimport { MAX_PARTY_SIZE } from '../core/party.js';\nimport { Party } from '../core/party.js';\nimport { Player } from '../core/player.js';\nimport { Player as PlayerProto } from '../core/proto/api.js';\nimport { Encounter as EncounterProto } from '../core/proto/common.js';\nimport { Raid as RaidProto } from '../core/proto/api.js';\nimport { Party as PartyProto } from '../core/proto/api.js';\nimport { Class } from '../core/proto/common.js';\nimport { Profession } from '../core/proto/common.js';\nimport { Race } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { Faction } from '../core/proto/common.js';\nimport { Glyphs } from '../core/proto/common.js';\nimport { BuffBot as BuffBotProto } from '../core/proto/ui.js';\nimport { playerToSpec, specNames } from '../core/proto_utils/utils.js';\nimport { classColors } from '../core/proto_utils/utils.js';\nimport { isTankSpec } from '../core/proto_utils/utils.js';\nimport { specToClass } from '../core/proto_utils/utils.js';\nimport { newRaidTarget } from '../core/proto_utils/utils.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { camelToSnakeCase } from '../core/utils.js';\nimport { formatDeltaTextElem } from '../core/utils.js';\nimport { getEnumValues } from '../core/utils.js';\nimport { hexToRgba } from '../core/utils.js';\n\nimport { BuffBot } from './buff_bot.js';\nimport { RaidSimUI } from './raid_sim_ui.js';\nimport { buffBotPresets, playerPresets, specSimFactories } from './presets.js';\n\nimport { BalanceDruid_Options as BalanceDruidOptions } from '../core/proto/druid.js';\nimport { SmitePriest_Options as SmitePriestOptions } from '../core/proto/priest.js';\nimport { MessageType } from '@protobuf-ts/runtime';\n\ndeclare var tippy: any;\ndeclare var $: any;\n\nconst NEW_PLAYER: number = -1;\n\nenum DragType {\n\tNone,\n\tNew,\n\tMove,\n\tSwap,\n\tCopy,\n}\n\nexport class RaidPicker extends Component {\n\treadonly raidSimUI: RaidSimUI;\n\treadonly raid: Raid;\n\treadonly partyPickers: Array<PartyPicker>;\n\treadonly newPlayerPicker: NewPlayerPicker;\n\n\t// Hold data about the player being dragged while the drag is happening.\n\tcurrentDragPlayer: Player<any> | BuffBot | null = null;\n\tcurrentDragPlayerFromIndex: number = NEW_PLAYER;\n\tcurrentDragType: DragType = DragType.New;\n\n\tconstructor(parent: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parent, 'raid-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\t\tthis.raid = raidSimUI.sim.raid;\n\n\t\tconst raidViewer = document.createElement('div');\n\t\traidViewer.classList.add('current-raid-viewer');\n\t\tthis.rootElem.appendChild(raidViewer);\n\t\traidViewer.innerHTML = `\n\t\t\t<div class=\"parties-container\">\n\t\t\t</div>\n\t\t`;\n\n\t\tconst partiesContainer = this.rootElem.getElementsByClassName('parties-container')[0] as HTMLDivElement;\n\t\tthis.partyPickers = this.raid.getParties().map((party, i) => new PartyPicker(partiesContainer, party, i, this));\n\n\t\tconst newPlayerPickerRoot = document.createElement('div');\n\t\tnewPlayerPickerRoot.classList.add('new-player-picker');\n\t\tthis.rootElem.appendChild(newPlayerPickerRoot);\n\n\t\tthis.newPlayerPicker = new NewPlayerPicker(newPlayerPickerRoot, this);\n\n\t\tthis.rootElem.ondragend = event => {\n\t\t\t// Uncomment to remove player when dropped 'off' the raid.\n\t\t\t//if (this.currentDragPlayerFromIndex != NEW_PLAYER) {\n\t\t\t//\tconst playerPicker = this.getPlayerPicker(this.currentDragPlayerFromIndex);\n\t\t\t//\tplayerPicker.setPlayer(null, null, DragType.None);\n\t\t\t//}\n\n\t\t\tthis.clearDragPlayer();\n\t\t};\n\t}\n\n\tgetCurrentFaction(): Faction {\n\t\treturn this.raid.sim.getFaction();\n\t}\n\n\tgetCurrentPhase(): number {\n\t\treturn this.raid.sim.getPhase();\n\t}\n\n\tgetPlayerPicker(raidIndex: number): PlayerPicker {\n\t\treturn this.partyPickers[Math.floor(raidIndex / MAX_PARTY_SIZE)].playerPickers[raidIndex % MAX_PARTY_SIZE];\n\t}\n\n\tgetPlayerPickers(): Array<PlayerPicker> {\n\t\treturn [...new Array(25).keys()].map(i => this.getPlayerPicker(i));\n\t}\n\n\tgetBuffBots(): Array<BuffBot> {\n\t\treturn this.getPlayerPickers()\n\t\t\t.filter(picker => picker.player instanceof BuffBot)\n\t\t\t.map(picker => picker.player as BuffBot);\n\t}\n\n\tsetBuffBots(eventID: EventID, newBuffBotProtos: Array<BuffBotProto>) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.getBuffBots().forEach(buffBot => this.getPlayerPicker(buffBot.getRaidIndex()).setPlayer(eventID, null, DragType.None));\n\n\t\t\tnewBuffBotProtos.forEach(buffBotProto => {\n\t\t\t\tconst settings = buffBotPresets.find(preset => preset.buffBotId == buffBotProto.id);\n\t\t\t\tif (!settings) {\n\t\t\t\t\tconsole.warn('Invalid buff bot ID: ' + buffBotProto.id);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst buffBot = new BuffBot(buffBotProto.id, this.raid.sim);\n\t\t\t\tbuffBot.fromProto(eventID, buffBotProto);\n\t\t\t\tthis.getPlayerPicker(buffBotProto.raidIndex).setPlayer(eventID, buffBot, DragType.None);\n\t\t\t});\n\t\t});\n\t}\n\n\tsetDragPlayer(player: Player<any> | BuffBot, fromIndex: number, type: DragType) {\n\t\tthis.clearDragPlayer();\n\n\t\tthis.currentDragPlayer = player;\n\t\tthis.currentDragPlayerFromIndex = fromIndex;\n\t\tthis.currentDragType = type;\n\n\t\tif (fromIndex != NEW_PLAYER) {\n\t\t\tconst playerPicker = this.getPlayerPicker(fromIndex);\n\t\t\tplayerPicker.rootElem.classList.add('dragFrom');\n\t\t}\n\t}\n\n\tclearDragPlayer() {\n\t\tif (this.currentDragPlayerFromIndex != NEW_PLAYER) {\n\t\t\tconst playerPicker = this.getPlayerPicker(this.currentDragPlayerFromIndex);\n\t\t\tplayerPicker.rootElem.classList.remove('dragFrom');\n\t\t}\n\n\t\tthis.currentDragPlayer = null;\n\t\tthis.currentDragPlayerFromIndex = NEW_PLAYER;\n\t\tthis.currentDragType = DragType.New;\n\t}\n}\n\nexport class PartyPicker extends Component {\n\treadonly party: Party;\n\treadonly index: number;\n\treadonly raidPicker: RaidPicker;\n\treadonly playerPickers: Array<PlayerPicker>;\n\n\tconstructor(parent: HTMLElement, party: Party, index: number, raidPicker: RaidPicker) {\n\t\tsuper(parent, 'party-picker-root');\n\t\tthis.party = party;\n\t\tthis.index = index;\n\t\tthis.raidPicker = raidPicker;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"party-header\">\n\t\t\t\t<span>Group ${index + 1}</span>\n\t\t\t\t<div class=\"party-results\">\n\t\t\t\t\t<span class=\"party-results-dps\"></span>\n\t\t\t\t\t<span class=\"party-results-reference-delta\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"players-container\">\n\t\t\t</div>\n\t\t`;\n\n\t\tconst playersContainer = this.rootElem.getElementsByClassName('players-container')[0] as HTMLDivElement;\n\t\tthis.playerPickers = [...Array(MAX_PARTY_SIZE).keys()].map(i => new PlayerPicker(playersContainer, this, i));\n\n\t\tconst dpsResultElem = this.rootElem.getElementsByClassName('party-results-dps')[0] as HTMLElement;\n\t\tconst referenceDeltaElem = this.rootElem.getElementsByClassName('party-results-reference-delta')[0] as HTMLElement;\n\n\t\tthis.raidPicker.raidSimUI.referenceChangeEmitter.on(() => {\n\t\t\tconst currentData = this.raidPicker.raidSimUI.getCurrentData();\n\t\t\tconst referenceData = this.raidPicker.raidSimUI.getReferenceData();\n\n\t\t\tconst partyDps = currentData?.simResult.raidMetrics.parties[this.index].dps.avg || 0;\n\t\t\tconst referenceDps = referenceData?.simResult.raidMetrics.parties[this.index].dps.avg || 0;\n\n\t\t\tif (partyDps == 0 && referenceDps == 0) {\n\t\t\t\tdpsResultElem.textContent = '';\n\t\t\t\treferenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdpsResultElem.textContent = partyDps.toFixed(1);\n\n\t\t\tif (!referenceData) {\n\t\t\t\treferenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformatDeltaTextElem(referenceDeltaElem, referenceDps, partyDps, 1);\n\t\t});\n\t}\n}\n\nexport class PlayerPicker extends Component {\n\t// Index of this player within its party (0-4).\n\treadonly index: number;\n\n\t// Index of this player within the whole raid (0-24).\n\treadonly raidIndex: number;\n\n\tplayer: Player<any> | BuffBot | null;\n\n\treadonly partyPicker: PartyPicker;\n\treadonly raidPicker: RaidPicker;\n\n\tprivate readonly labelElem: HTMLElement;\n\tprivate readonly iconElem: HTMLImageElement;\n\tprivate readonly nameElem: HTMLSpanElement;\n\tprivate readonly resultsElem: HTMLElement;\n\tprivate readonly dpsResultElem: HTMLElement;\n\tprivate readonly referenceDeltaElem: HTMLElement;\n\n\tconstructor(parent: HTMLElement, partyPicker: PartyPicker, index: number) {\n\t\tsuper(parent, 'player-picker-root');\n\t\tthis.index = index;\n\t\tthis.raidIndex = partyPicker.index * MAX_PARTY_SIZE + index;\n\t\tthis.player = null;\n\t\tthis.partyPicker = partyPicker;\n\t\tthis.raidPicker = partyPicker.raidPicker;\n\n\t\tthis.partyPicker.party.compChangeEmitter.on(eventID => {\n\t\t\tconst newPlayer = this.partyPicker.party.getPlayer(this.index);\n\t\t\tif (newPlayer != this.player && !(newPlayer == null && this.player instanceof BuffBot)) {\n\t\t\t\tthis.setPlayer(eventID, newPlayer, DragType.None);\n\t\t\t}\n\t\t});\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"player-label\">\n\t\t\t\t<img class=\"player-icon\"></img>\n\t\t\t\t<span class=\"player-name\" contenteditable></span>\n\t\t\t</div>\n\t\t\t<div class=\"player-spacer\">\n\t\t\t</div>\n\t\t\t<div class=\"player-options\">\n\t\t\t\t<span class=\"player-edit fa fa-edit\"></span>\n\t\t\t\t<span class=\"player-copy fa fa-copy\" draggable=\"true\"></span>\n\t\t\t\t<span class=\"player-delete fa fa-times\"></span>\n\t\t\t</div>\n\t\t\t<div class=\"player-results\">\n\t\t\t\t<span class=\"player-results-dps\"></span>\n\t\t\t\t<span class=\"player-results-reference-delta\"></span>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.labelElem = this.rootElem.getElementsByClassName('player-label')[0] as HTMLElement;\n\t\tthis.iconElem = this.rootElem.getElementsByClassName('player-icon')[0] as HTMLImageElement;\n\t\tthis.nameElem = this.rootElem.getElementsByClassName('player-name')[0] as HTMLSpanElement;\n\t\tthis.resultsElem = this.rootElem.getElementsByClassName('player-results')[0] as HTMLElement;\n\t\tthis.dpsResultElem = this.rootElem.getElementsByClassName('player-results-dps')[0] as HTMLElement;\n\t\tthis.referenceDeltaElem = this.rootElem.getElementsByClassName('player-results-reference-delta')[0] as HTMLElement;\n\n\t\tthis.nameElem.addEventListener('input', event => {\n\t\t\tif (this.player instanceof Player) {\n\t\t\t\tthis.player.setName(TypedEvent.nextEventID(), this.nameElem.textContent || '');\n\t\t\t}\n\t\t});\n\n\t\tconst maxLength = 15;\n\t\tthis.nameElem.addEventListener('keydown', event => {\n\t\t\t// 9 is tab, 13 is enter\n\t\t\tif (event.keyCode == 9 || event.keyCode == 13) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst realPlayerPickers = this.raidPicker.getPlayerPickers().filter(pp => pp.player instanceof Player);\n\t\t\t\tconst indexOfThis = realPlayerPickers.indexOf(this);\n\t\t\t\tif (indexOfThis != -1 && realPlayerPickers.length > indexOfThis + 1) {\n\t\t\t\t\trealPlayerPickers[indexOfThis + 1].nameElem.focus();\n\t\t\t\t} else {\n\t\t\t\t\tthis.nameElem.blur();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// escape\n\t\t\tif (event.keyCode == 27) {\n\t\t\t\tthis.nameElem.blur();\n\t\t\t}\n\n\t\t\t// 8 is backspace, 46 is delete, \n\t\t\tif ((event.keyCode != 8 && event.keyCode != 46) && (this.nameElem.textContent?.length || 0) >= maxLength) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\n\t\tconst emptyName = 'Unnamed';\n\t\tthis.nameElem.addEventListener('focusin', event => {\n\t\t\tconst selection = window.getSelection();\n\t\t\tif (selection) {\n\t\t\t\tconst range = document.createRange();\n\t\t\t\trange.selectNodeContents(this.nameElem);\n\t\t\t\tselection.removeAllRanges();\n\t\t\t\tselection.addRange(range);\n\t\t\t}\n\t\t});\n\t\tthis.nameElem.addEventListener('focusout', event => {\n\t\t\tif (!this.nameElem.textContent) {\n\t\t\t\tthis.nameElem.textContent = emptyName;\n\t\t\t\tif (this.player instanceof Player) {\n\t\t\t\t\tthis.player.setName(TypedEvent.nextEventID(), emptyName);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tconst dragStart = (event: DragEvent, type: DragType) => {\n\t\t\tif (this.player == null) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tevent.dataTransfer!.dropEffect = 'move';\n\t\t\tevent.dataTransfer!.effectAllowed = 'all';\n\n\t\t\tconst iconSrc = this.iconElem.src;\n\t\t\tconst dragImage = new Image();\n\t\t\tdragImage.src = iconSrc;\n\t\t\tevent.dataTransfer!.setDragImage(dragImage, 30, 30);\n\t\t\tif (this.player instanceof Player) {\n\t\t\t\tvar playerDataProto = this.player.toProto(true);\n\t\t\t\tevent.dataTransfer!.setData(\"text/plain\", btoa(String.fromCharCode(...PlayerProto.toBinary(playerDataProto))));\n\t\t\t}\n\t\t\tthis.raidPicker.setDragPlayer(this.player, this.raidIndex, type);\n\t\t};\n\n\t\tthis.labelElem.ondragstart = event => {\n\t\t\tdragStart(event, DragType.Swap);\n\t\t};\n\t\tthis.resultsElem.ondragstart = event => {\n\t\t\tdragStart(event, DragType.Swap);\n\t\t};\n\n\t\tconst copyElem = this.rootElem.getElementsByClassName('player-copy')[0] as HTMLSpanElement;\n\t\ttippy(copyElem, {\n\t\t\t'content': 'Drag to Copy',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\tcopyElem.ondragstart = event => {\n\t\t\tdragStart(event, DragType.Copy);\n\t\t};\n\n\t\tconst deleteElem = this.rootElem.getElementsByClassName('player-delete')[0] as HTMLSpanElement;\n\t\ttippy(deleteElem, {\n\t\t\t'content': 'Click to Delete',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\tdeleteElem.addEventListener('click', event => {\n\t\t\tthis.setPlayer(TypedEvent.nextEventID(), null, DragType.None);\n\t\t});\n\n\t\tlet dragEnterCounter = 0;\n\t\tthis.rootElem.ondragenter = event => {\n\t\t\tevent.preventDefault();\n\t\t\tdragEnterCounter++;\n\t\t\tthis.rootElem.classList.add('dragto');\n\t\t};\n\t\tthis.rootElem.ondragleave = event => {\n\t\t\tevent.preventDefault();\n\t\t\tdragEnterCounter--;\n\t\t\tif (dragEnterCounter <= 0) {\n\t\t\t\tthis.rootElem.classList.remove('dragto');\n\t\t\t}\n\t\t};\n\t\tthis.rootElem.ondragover = event => {\n\t\t\tevent.preventDefault();\n\t\t};\n\t\tthis.rootElem.ondrop = event => {\n\t\t\tvar dropData = event.dataTransfer!.getData(\"text/plain\");\n\n\t\t\tevent.preventDefault();\n\t\t\tdragEnterCounter = 0;\n\t\t\tthis.rootElem.classList.remove('dragto');\n\n\t\t\tconst eventID = TypedEvent.nextEventID();\n\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\tif (this.raidPicker.currentDragPlayer == null && dropData.length == 0) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.raidPicker.currentDragPlayerFromIndex == this.raidIndex) {\n\t\t\t\t\tthis.raidPicker.clearDragPlayer();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst dragType = this.raidPicker.currentDragType;\n\n\t\t\t\tif (this.raidPicker.currentDragPlayerFromIndex != NEW_PLAYER) {\n\t\t\t\t\tconst fromPlayerPicker = this.raidPicker.getPlayerPicker(this.raidPicker.currentDragPlayerFromIndex);\n\t\t\t\t\tif (dragType == DragType.Swap) {\n\t\t\t\t\t\tfromPlayerPicker.setPlayer(eventID, this.player, dragType);\n\t\t\t\t\t\tvar myicon = this.iconElem.src\n\t\t\t\t\t\tthis.iconElem.src = fromPlayerPicker.iconElem.src;\n\t\t\t\t\t\tfromPlayerPicker.iconElem.src = myicon;\n\t\t\t\t\t} else if (dragType == DragType.Move) {\n\t\t\t\t\t\tthis.iconElem.src = fromPlayerPicker.iconElem.src;\n\t\t\t\t\t\tfromPlayerPicker.setPlayer(eventID, null, dragType);\n\t\t\t\t\t}\n\t\t\t\t} else if (this.raidPicker.currentDragPlayer == null) {\n\t\t\t\t\t// This would be a copy from another window.\n\t\t\t\t\tconst binary = atob(dropData);\n\t\t\t\t\tconst bytes = new Uint8Array(binary.length);\n\t\t\t\t\tfor (let i = 0; i < bytes.length; i++) {\n\t\t\t\t\t\tbytes[i] = binary.charCodeAt(i);\n\t\t\t\t\t}\n\t\t\t\t\tconst playerProto = PlayerProto.fromBinary(bytes);\n\n\t\t\t\t\tvar localPlayer = new Player(playerToSpec(playerProto), this.raidPicker.raidSimUI.sim);\n\t\t\t\t\tlocalPlayer.fromProto(eventID, playerProto);\n\t\t\t\t\tthis.raidPicker.currentDragPlayer = localPlayer;\n\t\t\t\t}\n\n\t\t\t\tif (dragType == DragType.Copy) {\n\t\t\t\t\tthis.setPlayer(eventID, this.raidPicker.currentDragPlayer!.clone(eventID), dragType);\n\t\t\t\t} else {\n\t\t\t\t\tthis.setPlayer(eventID, this.raidPicker.currentDragPlayer, dragType);\n\t\t\t\t}\n\n\t\t\t\tif (this.iconElem.src == \"\") {\n\t\t\t\t\tthis.iconElem.src = playerPresets.filter(preset => {\n\t\t\t\t\t\treturn preset.spec == localPlayer.spec;\n\t\t\t\t\t})[0].iconUrl;\n\t\t\t\t}\n\n\t\t\t\tthis.raidPicker.clearDragPlayer();\n\t\t\t});\n\t\t};\n\n\t\tconst editElem = this.rootElem.getElementsByClassName('player-edit')[0] as HTMLSpanElement;\n\t\ttippy(editElem, {\n\t\t\t'content': 'Edit',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\teditElem.addEventListener('click', event => {\n\t\t\tif (this.player instanceof Player) {\n\t\t\t\tnew PlayerEditorModal(this.player);\n\t\t\t}\n\t\t});\n\n\t\tthis.raidPicker.raidSimUI.referenceChangeEmitter.on(() => {\n\t\t\tconst currentData = this.raidPicker.raidSimUI.getCurrentData();\n\t\t\tconst referenceData = this.raidPicker.raidSimUI.getReferenceData();\n\n\t\t\tconst playerDps = currentData?.simResult.getDamageMetrics({ player: this.raidIndex }).avg || 0;\n\t\t\tconst referenceDps = referenceData?.simResult.getDamageMetrics({ player: this.raidIndex }).avg || 0;\n\n\t\t\tif (playerDps == 0 && referenceDps == 0) {\n\t\t\t\tthis.dpsResultElem.textContent = '';\n\t\t\t\tthis.referenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dpsResultElem.textContent = playerDps.toFixed(1);\n\n\t\t\tif (!referenceData) {\n\t\t\t\tthis.referenceDeltaElem.textContent = '';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformatDeltaTextElem(this.referenceDeltaElem, referenceDps, playerDps, 1);\n\t\t});\n\n\t\tthis.update();\n\t}\n\n\tsetPlayer(eventID: EventID, newPlayer: Player<any> | BuffBot | null, dragType: DragType) {\n\t\tif (newPlayer == this.player) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dpsResultElem.textContent = '';\n\t\tthis.referenceDeltaElem.textContent = '';\n\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.player = newPlayer;\n\t\t\tif (newPlayer instanceof BuffBot) {\n\t\t\t\tthis.partyPicker.party.setPlayer(eventID, this.index, null);\n\t\t\t\tnewPlayer.setRaidIndex(eventID, this.raidIndex);\n\t\t\t} else if (newPlayer instanceof Player) {\n\t\t\t\tthis.partyPicker.party.setPlayer(eventID, this.index, newPlayer);\n\n\t\t\t\tif (dragType == DragType.New) {\n\t\t\t\t\tif (isTankSpec(newPlayer.spec)) {\n\t\t\t\t\t\tconst tanks = this.raidPicker.raid.getTanks();\n\t\t\t\t\t\tconst emptyIdx = tanks.findIndex(tank => this.raidPicker.raid.getPlayerFromRaidTarget(tank) == null);\n\t\t\t\t\t\tif (emptyIdx == -1) {\n\t\t\t\t\t\t\tif (tanks.length < 3) {\n\t\t\t\t\t\t\t\tthis.raidPicker.raid.setTanks(eventID, tanks.concat([newPlayer.makeRaidTarget()]));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttanks[emptyIdx] = newPlayer.makeRaidTarget();\n\t\t\t\t\t\t\tthis.raidPicker.raid.setTanks(eventID, tanks);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// On creation, boomies should default to innervating themselves.\n\t\t\t\t\tif (newPlayer.spec == Spec.SpecBalanceDruid) {\n\t\t\t\t\t\tsetBalanceDruidSelfInnervate(eventID, newPlayer);\n\t\t\t\t\t} else if (newPlayer.spec == Spec.SpecSmitePriest) {\n\t\t\t\t\t\tsetSmitePriestSelfPI(eventID, newPlayer);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.partyPicker.party.setPlayer(eventID, this.index, newPlayer);\n\t\t\t\tthis.partyPicker.party.compChangeEmitter.emit(eventID);\n\t\t\t}\n\t\t});\n\n\t\tthis.update();\n\t}\n\n\tprivate update() {\n\t\tif (this.player == null) {\n\t\t\tthis.rootElem.classList.add('empty');\n\t\t\tthis.rootElem.classList.remove('buff-bot');\n\t\t\tthis.rootElem.style.backgroundColor = 'black';\n\t\t\tthis.labelElem.setAttribute('draggable', 'false');\n\t\t\tthis.resultsElem.setAttribute('draggable', 'false');\n\t\t\tthis.nameElem.textContent = '';\n\t\t\tthis.nameElem.removeAttribute('contenteditable');\n\t\t} else if (this.player instanceof BuffBot) {\n\t\t\tthis.rootElem.classList.remove('empty');\n\t\t\tthis.rootElem.classList.add('buff-bot');\n\t\t\tthis.rootElem.style.backgroundColor = classColors[specToClass[this.player.spec]];\n\t\t\tthis.labelElem.setAttribute('draggable', 'true');\n\t\t\tthis.resultsElem.setAttribute('draggable', 'true');\n\t\t\tthis.nameElem.textContent = this.player.name;\n\t\t\tthis.nameElem.removeAttribute('contenteditable');\n\t\t\tthis.iconElem.src = this.player.settings.iconUrl;\n\t\t} else {\n\t\t\tthis.rootElem.classList.remove('empty');\n\t\t\tthis.rootElem.classList.remove('buff-bot');\n\t\t\tthis.rootElem.style.backgroundColor = this.player.getClassColor();\n\t\t\tthis.labelElem.setAttribute('draggable', 'true');\n\t\t\tthis.resultsElem.setAttribute('draggable', 'true');\n\t\t\tthis.nameElem.textContent = this.player.getName();\n\t\t\tthis.nameElem.setAttribute('contenteditable', '');\n\t\t\tthis.iconElem.src = this.player.getTalentTreeIcon();\n\t\t}\n\t}\n}\n\nclass PlayerEditorModal extends Component {\n\tconstructor(player: Player<any>) {\n\t\tsuper(document.body, 'player-editor-modal');\n\n\t\tthis.rootElem.id = 'playerEditorModal';\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"player-editor within-raid-sim\">\n\t\t\t</div>\n\t\t`;\n\n\t\tnew CloseButton(this.rootElem, () => {\n\t\t\t$('#playerEditorModal').bPopup().close();\n\t\t\tthis.rootElem.remove();\n\t\t});\n\n\t\tconst editorRoot = this.rootElem.getElementsByClassName('player-editor')[0] as HTMLElement;\n\t\tconst individualSim = specSimFactories[player.spec]!(editorRoot, player);\n\n\t\t$('#playerEditorModal').bPopup({\n\t\t\tcloseClass: 'player-editor-close',\n\t\t\tonClose: () => {\n\t\t\t\tthis.rootElem.remove();\n\t\t\t},\n\t\t});\n\t}\n}\n\nclass NewPlayerPicker extends Component {\n\treadonly raidPicker: RaidPicker;\n\n\tconstructor(parent: HTMLElement, raidPicker: RaidPicker) {\n\t\tsuper(parent, 'new-player-picker-root');\n\t\tthis.raidPicker = raidPicker;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<div class=\"new-player-picker-controls\">\n\t\t\t\t<div class=\"faction-selector\"></div>\n\t\t\t\t<div class=\"phase-selector\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"presets-container\"></div>\n\t\t\t<div class=\"buff-bots-container\">\n\t\t\t\t<div class=\"buff-bots-title\">\n\t\t\t\t\t<span class=\"buff-bots-title-text\">Buff Bots</span>\n\t\t\t\t\t<span class=\"buff-bots-tooltip fa fa-info-circle\"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst factionSelector = new EnumPicker<NewPlayerPicker>(this.rootElem.getElementsByClassName('faction-selector')[0] as HTMLElement, this, {\n\t\t\tlabel: 'Faction',\n\t\t\tlabelTooltip: 'Default faction for newly-created players.',\n\t\t\tvalues: [\n\t\t\t\t{ name: 'Alliance', value: Faction.Alliance },\n\t\t\t\t{ name: 'Horde', value: Faction.Horde },\n\t\t\t],\n\t\t\tchangedEvent: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.factionChangeEmitter,\n\t\t\tgetValue: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.getFaction(),\n\t\t\tsetValue: (eventID: EventID, picker: NewPlayerPicker, newValue: Faction) => {\n\t\t\t\tthis.raidPicker.raid.sim.setFaction(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst phaseSelector = new EnumPicker<NewPlayerPicker>(this.rootElem.getElementsByClassName('phase-selector')[0] as HTMLElement, this, {\n\t\t\tlabel: 'Phase',\n\t\t\tlabelTooltip: 'Newly-created players will start with approximate BIS gear from this phase.',\n\t\t\tvalues: [\n\t\t\t\t{ name: '1', value: 1 },\n\t\t\t\t// Presets aren't filled for most roles so disable these options for now.\n\t\t\t\t//{ name: '2', value: 2 },\n\t\t\t\t//{ name: '3', value: 3 },\n\t\t\t\t//{ name: '4', value: 4 },\n\t\t\t\t//{ name: '5', value: 5 },\n\t\t\t],\n\t\t\tchangedEvent: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.phaseChangeEmitter,\n\t\t\tgetValue: (picker: NewPlayerPicker) => this.raidPicker.raid.sim.getPhase(),\n\t\t\tsetValue: (eventID: EventID, picker: NewPlayerPicker, newValue: number) => {\n\t\t\t\tthis.raidPicker.raid.sim.setPhase(eventID, newValue);\n\t\t\t},\n\t\t});\n\n\t\tconst presetsContainer = this.rootElem.getElementsByClassName('presets-container')[0] as HTMLElement;\n\t\tgetEnumValues(Class).forEach(wowClass => {\n\t\t\tif (wowClass == Class.ClassUnknown) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst matchingPresets = playerPresets.filter(preset => specToClass[preset.spec] == wowClass);\n\t\t\tif (matchingPresets.length == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst classPresetsContainer = document.createElement('div');\n\t\t\tclassPresetsContainer.classList.add('class-presets-container');\n\t\t\tpresetsContainer.appendChild(classPresetsContainer);\n\t\t\tclassPresetsContainer.style.backgroundColor = hexToRgba(classColors[wowClass as Class], 0.5);\n\n\t\t\tmatchingPresets.forEach(matchingPreset => {\n\t\t\t\tconst presetElem = document.createElement('div');\n\t\t\t\tpresetElem.classList.add('preset-picker');\n\t\t\t\tclassPresetsContainer.appendChild(presetElem);\n\n\t\t\t\tconst presetIconElem = document.createElement('img');\n\t\t\t\tpresetIconElem.classList.add('preset-picker-icon');\n\t\t\t\tpresetElem.appendChild(presetIconElem);\n\t\t\t\tpresetIconElem.src = matchingPreset.iconUrl;\n\t\t\t\ttippy(presetIconElem, {\n\t\t\t\t\t'content': matchingPreset.tooltip,\n\t\t\t\t\t'allowHTML': true,\n\t\t\t\t});\n\n\t\t\t\tpresetElem.setAttribute('draggable', 'true');\n\t\t\t\tpresetElem.ondragstart = event => {\n\t\t\t\t\tconst eventID = TypedEvent.nextEventID();\n\t\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\t\tconst dragImage = new Image();\n\t\t\t\t\t\tdragImage.src = matchingPreset.iconUrl;\n\t\t\t\t\t\tevent.dataTransfer!.setDragImage(dragImage, 30, 30);\n\t\t\t\t\t\tevent.dataTransfer!.setData(\"text/plain\", \"\");\n\t\t\t\t\t\tevent.dataTransfer!.dropEffect = 'copy';\n\n\n\t\t\t\t\t\tconst newPlayer = new Player(matchingPreset.spec, this.raidPicker.raid.sim);\n\t\t\t\t\t\tnewPlayer.applySharedDefaults(eventID);\n\t\t\t\t\t\tnewPlayer.setRace(eventID, matchingPreset.defaultFactionRaces[this.raidPicker.getCurrentFaction()]);\n\t\t\t\t\t\tnewPlayer.setRotation(eventID, matchingPreset.rotation);\n\t\t\t\t\t\tnewPlayer.setTalentsString(eventID, matchingPreset.talents.talentsString);\n\t\t\t\t\t\tnewPlayer.setGlyphs(eventID, matchingPreset.talents.glyphs || Glyphs.create());\n\t\t\t\t\t\tnewPlayer.setSpecOptions(eventID, matchingPreset.specOptions);\n\t\t\t\t\t\tnewPlayer.setConsumes(eventID, matchingPreset.consumes);\n\t\t\t\t\t\tnewPlayer.setName(eventID, matchingPreset.defaultName);\n\t\t\t\t\t\tnewPlayer.setProfession1(eventID, matchingPreset.otherDefaults?.profession1 || Profession.Engineering);\n\t\t\t\t\t\tnewPlayer.setProfession2(eventID, matchingPreset.otherDefaults?.profession2 || Profession.Jewelcrafting);\n\t\t\t\t\t\tnewPlayer.setDistanceFromTarget(eventID, matchingPreset.otherDefaults?.distanceFromTarget || 0);\n\n\t\t\t\t\t\t// Need to wait because the gear might not be loaded yet.\n\t\t\t\t\t\tthis.raidPicker.raid.sim.waitForInit().then(() => {\n\t\t\t\t\t\t\tnewPlayer.setGear(\n\t\t\t\t\t\t\t\teventID,\n\t\t\t\t\t\t\t\tthis.raidPicker.raid.sim.lookupEquipmentSpec(\n\t\t\t\t\t\t\t\t\tmatchingPreset.defaultGear[this.raidPicker.getCurrentFaction()][this.raidPicker.getCurrentPhase()]));\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.raidPicker.setDragPlayer(newPlayer, NEW_PLAYER, DragType.New);\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\n\t\tconst buffbotsTooltip = this.rootElem.getElementsByClassName('buff-bots-tooltip')[0] as HTMLElement;\n\t\ttippy(buffbotsTooltip, {\n\t\t\t'content': 'Buff bots do not do DPS or any actions at all, except to buff their raid/party members. They are used as placeholders for classes we haven\\'t implemented yet, or never will (e.g. healers) so that a proper raid environment can still be simulated.',\n\t\t\t'allowHTML': true,\n\t\t});\n\n\t\tconst buffbotsContainer = this.rootElem.getElementsByClassName('buff-bots-container')[0] as HTMLElement;\n\t\tgetEnumValues(Class).forEach(wowClass => {\n\t\t\tif (wowClass == Class.ClassUnknown) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst matchingBuffBots = buffBotPresets\n\t\t\t\t.filter(buffBot => specToClass[buffBot.spec] == wowClass)\n\t\t\t\t.filter(buffBot => !buffBot.deprecated);\n\t\t\tif (matchingBuffBots.length == 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst classPresetsContainer = document.createElement('div');\n\t\t\tclassPresetsContainer.classList.add('class-presets-container');\n\t\t\tbuffbotsContainer.appendChild(classPresetsContainer);\n\t\t\tclassPresetsContainer.style.backgroundColor = hexToRgba(classColors[wowClass as Class], 0.5);\n\n\t\t\tmatchingBuffBots.forEach(matchingBuffBot => {\n\t\t\t\tconst presetElem = document.createElement('div');\n\t\t\t\tpresetElem.classList.add('preset-picker');\n\t\t\t\tpresetElem.classList.add('preset-picker-buff-bot');\n\t\t\t\tclassPresetsContainer.appendChild(presetElem);\n\n\t\t\t\tconst presetIconElem = document.createElement('img');\n\t\t\t\tpresetIconElem.classList.add('preset-picker-icon');\n\t\t\t\tpresetElem.appendChild(presetIconElem);\n\t\t\t\tpresetIconElem.src = matchingBuffBot.iconUrl;\n\t\t\t\ttippy(presetIconElem, {\n\t\t\t\t\t'content': matchingBuffBot.tooltip,\n\t\t\t\t\t'allowHTML': true,\n\t\t\t\t});\n\n\t\t\t\tpresetElem.setAttribute('draggable', 'true');\n\t\t\t\tpresetElem.ondragstart = event => {\n\t\t\t\t\tconst dragImage = new Image();\n\t\t\t\t\tdragImage.src = matchingBuffBot.iconUrl;\n\t\t\t\t\tevent.dataTransfer!.setDragImage(dragImage, 30, 30);\n\t\t\t\t\tevent.dataTransfer!.setData(\"text/plain\", \"\");\n\t\t\t\t\tevent.dataTransfer!.dropEffect = 'copy';\n\n\t\t\t\t\tthis.raidPicker.setDragPlayer(new BuffBot(matchingBuffBot.buffBotId, this.raidPicker.raidSimUI.sim), NEW_PLAYER, DragType.New);\n\t\t\t\t};\n\t\t\t});\n\t\t});\n\t}\n}\n\nfunction setBalanceDruidSelfInnervate(eventID: EventID, player: Player<any>) {\n\tconst newOptions = player.getSpecOptions() as BalanceDruidOptions;\n\tnewOptions.innervateTarget = newRaidTarget(player.getRaidIndex());\n\tplayer.setSpecOptions(eventID, newOptions);\n}\nfunction setSmitePriestSelfPI(eventID: EventID, player: Player<any>) {\n\tconst newOptions = player.getSpecOptions() as SmitePriestOptions;\n\tnewOptions.powerInfusionTarget = newRaidTarget(player.getRaidIndex());\n\tplayer.setSpecOptions(eventID, newOptions);\n}\n","import { Component } from '../core/components/component.js';\nimport { Input, InputConfig } from '../core/components/input.js';\nimport { RaidTargetPicker } from '../core/components/raid_target_picker.js';\nimport { Player } from '../core/player.js';\nimport { Raid } from '../core/raid.js';\nimport { EventID, TypedEvent } from '../core/typed_event.js';\nimport { Class } from '../core/proto/common.js';\nimport { RaidTarget } from '../core/proto/common.js';\nimport { Spec } from '../core/proto/common.js';\nimport { emptyRaidTarget } from '../core/proto_utils/utils.js';\n\nimport { RaidSimUI } from './raid_sim_ui.js';\n\ndeclare var tippy: any;\n\nconst MAX_TANKS = 4;\n\nexport class TanksPicker extends Component {\n\treadonly raidSimUI: RaidSimUI;\n\n\tconstructor(parentElem: HTMLElement, raidSimUI: RaidSimUI) {\n\t\tsuper(parentElem, 'tanks-picker-root');\n\t\tthis.raidSimUI = raidSimUI;\n\n\t\tthis.rootElem.innerHTML = `\n\t\t\t<fieldset class=\"tanks-picker-container settings-section\">\n\t\t\t\t<legend>TANKS</legend>\n\t\t\t</fieldset>\n\t\t`;\n\n\t\tconst tanksContainer = this.rootElem.getElementsByClassName('tanks-picker-container')[0] as HTMLElement;\n\t\tconst raid = this.raidSimUI.sim.raid;\n\n\t\tfor (let i = 0; i < MAX_TANKS; i++) {\n\t\t\tconst row = document.createElement('div');\n\t\t\trow.classList.add('tank-picker-row');\n\t\t\ttanksContainer.appendChild(row);\n\n\t\t\tconst sourceElem = document.createElement('span');\n\t\t\tsourceElem.textContent = i == 0 ? 'MAIN TANK' : `TANK ${i + 1}`;\n\t\t\tsourceElem.classList.add('tank-picker-label');\n\t\t\trow.appendChild(sourceElem);\n\n\t\t\tconst arrow = document.createElement('span');\n\t\t\tarrow.classList.add('fa', 'fa-arrow-right');\n\t\t\trow.appendChild(arrow);\n\n\t\t\tconst tankIndex = i;\n\t\t\tconst raidTargetPicker = new RaidTargetPicker<Raid>(row, raid, raid, {\n\t\t\t\textraCssClasses: [\n\t\t\t\t\t'tank-picker',\n\t\t\t\t],\n\t\t\t\tnoTargetLabel: 'Unassigned',\n\t\t\t\tcompChangeEmitter: raid.compChangeEmitter,\n\n\t\t\t\tchangedEvent: (raid: Raid) => raid.tanksChangeEmitter,\n\t\t\t\tgetValue: (raid: Raid) => raid.getTanks()[tankIndex] || emptyRaidTarget(),\n\t\t\t\tsetValue: (eventID: EventID, raid: Raid, newValue: RaidTarget) => {\n\t\t\t\t\tconst tanks = raid.getTanks();\n\t\t\t\t\tfor (let i = 0; i < tankIndex; i++) {\n\t\t\t\t\t\tif (!tanks[i]) {\n\t\t\t\t\t\t\ttanks.push(emptyRaidTarget());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttanks[tankIndex] = newValue;\n\t\t\t\t\traid.setTanks(eventID, tanks);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n","import { BooleanPicker } from \"../core/components/boolean_picker.js\";\nimport { DetailedResults } from \"../core/components/detailed_results.js\";\nimport { EncounterPicker } from \"../core/components/encounter_picker.js\";\nimport { LogRunner } from \"../core/components/log_runner.js\";\nimport { addRaidSimAction, RaidSimResultsManager, ReferenceData } from \"../core/components/raid_sim_action.js\";\nimport { SavedDataManager } from \"../core/components/saved_data_manager.js\";\nimport { SettingsMenu } from \"../core/components/settings_menu.js\";\n\nimport * as Tooltips from \"../core/constants/tooltips.js\";\nimport { Encounter } from \"../core/encounter.js\";\nimport { Player } from \"../core/player.js\";\nimport { Raid as RaidProto } from \"../core/proto/api.js\";\nimport { Class, Encounter as EncounterProto, Faction, Stat, TristateEffect } from \"../core/proto/common.js\";\nimport { Blessings } from \"../core/proto/paladin.js\";\nimport { BlessingsAssignments, BuffBot as BuffBotProto, RaidSimSettings, SavedEncounter, SavedRaid } from \"../core/proto/ui.js\";\nimport { playerToSpec } from \"../core/proto_utils/utils.js\";\nimport { Raid } from \"../core/raid.js\";\nimport { Sim } from \"../core/sim.js\";\nimport { SimUI } from \"../core/sim_ui.js\";\nimport { LaunchStatus, raidSimLaunched } from '../core/launched_sims.js';\nimport { EventID, TypedEvent } from \"../core/typed_event.js\";\n\nimport { AssignmentsPicker } from \"./assignments_picker.js\";\nimport { BlessingsPicker } from \"./blessings_picker.js\";\nimport { BuffBot } from \"./buff_bot.js\";\nimport { newRaidExporters, newRaidImporters } from \"./import_export.js\";\nimport { implementedSpecs } from \"./presets.js\";\nimport { RaidPicker } from \"./raid_picker.js\";\nimport { TanksPicker } from \"./tanks_picker.js\";\n\ndeclare var Muuri: any;\ndeclare var tippy: any;\ndeclare var pako: any;\n\nexport interface RaidSimConfig {\n\tknownIssues?: Array<string>,\n}\n\nconst extraKnownIssues: Array<string> = [\n\t//'We\\'re still missing implementations for many specs. If you\\'d like to help us out, check out our <a href=\"https://github.com/wowsims/wotlk\">Github project</a> or <a href=\"https://discord.gg/jJMPr9JWwx\">join our discord</a>!',\n];\n\nexport class RaidSimUI extends SimUI {\n\tprivate readonly config: RaidSimConfig;\n\tprivate raidSimResultsManager: RaidSimResultsManager | null = null;\n\tpublic raidPicker: RaidPicker | null = null;\n\tprivate blessingsPicker: BlessingsPicker | null = null;\n\n\t// Emits when the raid comp changes. Includes changes to buff bots.\n\treadonly compChangeEmitter = new TypedEvent<void>();\n\treadonly changeEmitter = new TypedEvent<void>();\n\n\treadonly referenceChangeEmitter = new TypedEvent<void>();\n\n\tprivate settingsMuuri: any;\n\n\tconstructor(parentElem: HTMLElement, config: RaidSimConfig) {\n\t\tsuper(parentElem, new Sim(), {\n\t\t\tspec: null,\n\t\t\tlaunchStatus: raidSimLaunched ? LaunchStatus.Launched : LaunchStatus.Unlaunched,\n\t\t\tknownIssues: (config.knownIssues || []).concat(extraKnownIssues),\n\t\t});\n\t\tthis.rootElem.classList.add('raid-sim-ui');\n\n\t\tthis.config = config;\n\t\tthis.settingsMuuri = null;\n\n\t\tthis.sim.raid.compChangeEmitter.on(eventID => this.compChangeEmitter.emit(eventID));\n\t\tthis.sim.setModifyRaidProto(raidProto => this.modifyRaidProto(raidProto));\n\n\t\t[\n\t\t\tthis.compChangeEmitter,\n\t\t\tthis.sim.changeEmitter,\n\t\t].forEach(emitter => emitter.on(eventID => this.changeEmitter.emit(eventID)));\n\n\t\tthis.sim.waitForInit().then(() => this.loadSettings());\n\n\t\tthis.addSidebarComponents();\n\t\tthis.addTopbarComponents();\n\t\tthis.addRaidTab();\n\t\tthis.addSettingsTab();\n\t\tthis.addDetailedResultsTab();\n\t\tthis.addLogTab();\n\n\t\tthis.changeEmitter.on(() => this.recomputeSettingsLayout());\n\t}\n\n\tprivate loadSettings() {\n\t\tconst initEventID = TypedEvent.nextEventID();\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tlet loadedSettings = false;\n\n\t\t\tconst savedSettings = window.localStorage.getItem(this.getSettingsStorageKey());\n\t\t\tif (savedSettings != null) {\n\t\t\t\ttry {\n\t\t\t\t\tconst settings = RaidSimSettings.fromJsonString(savedSettings);\n\t\t\t\t\tthis.fromProto(initEventID, settings);\n\t\t\t\t\tloadedSettings = true;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn('Failed to parse saved settings: ' + e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!loadedSettings) {\n\t\t\t\tthis.applyDefaults(initEventID);\n\t\t\t}\n\n\t\t\t// This needs to go last so it doesn't re-store things as they are initialized.\n\t\t\tthis.changeEmitter.on(eventID => {\n\t\t\t\tconst jsonStr = RaidSimSettings.toJsonString(this.toProto());\n\t\t\t\twindow.localStorage.setItem(this.getSettingsStorageKey(), jsonStr);\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate addSidebarComponents() {\n\t\tthis.raidSimResultsManager = addRaidSimAction(this);\n\t\tthis.raidSimResultsManager.changeEmitter.on(eventID => this.referenceChangeEmitter.emit(eventID));\n\t}\n\n\tprivate addTopbarComponents() {\n\t\tthis.addToolbarItem(newRaidImporters(this));\n\t\tthis.addToolbarItem(newRaidExporters(this));\n\n\t\tconst settingsMenu = document.createElement('span');\n\t\tsettingsMenu.classList.add('fas', 'fa-cog');\n\t\ttippy(settingsMenu, {\n\t\t\t'content': 'Settings',\n\t\t\t'allowHTML': true,\n\t\t});\n\t\tsettingsMenu.addEventListener('click', event => {\n\t\t\tnew SettingsMenu(this.rootElem, this);\n\t\t});\n\t\tthis.addToolbarItem(settingsMenu);\n\t}\n\n\tprivate addRaidTab() {\n\t\tthis.addTab('RAID', 'raid-tab', `\n\t\t\t<div class=\"raid-picker\">\n\t\t\t</div>\n\t\t\t<div class=\"saved-raids-div\">\n\t\t\t\t<div class=\"saved-raids-manager\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.raidPicker = new RaidPicker(this.rootElem.getElementsByClassName('raid-picker')[0] as HTMLElement, this);\n\n\t\tconst savedRaidManager = new SavedDataManager<RaidSimUI, SavedRaid>(this.rootElem.getElementsByClassName('saved-raids-manager')[0] as HTMLElement, this, {\n\t\t\tlabel: 'Raid',\n\t\t\tstorageKey: this.getSavedRaidStorageKey(),\n\t\t\tgetData: (raidSimUI: RaidSimUI) => SavedRaid.create({\n\t\t\t\traid: this.sim.raid.toProto(),\n\t\t\t\tbuffBots: this.getBuffBots().map(b => b.toProto()),\n\t\t\t\tblessings: this.blessingsPicker!.getAssignments(),\n\t\t\t\tfaction: this.sim.getFaction(),\n\t\t\t\tphase: this.sim.getPhase(),\n\t\t\t}),\n\t\t\tsetData: (eventID: EventID, raidSimUI: RaidSimUI, newRaid: SavedRaid) => {\n\t\t\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\t\t\tthis.sim.raid.fromProto(eventID, newRaid.raid || RaidProto.create());\n\t\t\t\t\tthis.raidPicker!.setBuffBots(eventID, newRaid.buffBots);\n\t\t\t\t\tthis.blessingsPicker!.setAssignments(eventID, newRaid.blessings || BlessingsAssignments.create());\n\t\t\t\t\tif (newRaid.faction) this.sim.setFaction(eventID, newRaid.faction);\n\t\t\t\t\tif (newRaid.phase) this.sim.setPhase(eventID, newRaid.phase);\n\t\t\t\t});\n\t\t\t},\n\t\t\tchangeEmitters: [this.changeEmitter, this.sim.changeEmitter],\n\t\t\tequals: (a: SavedRaid, b: SavedRaid) => {\n\t\t\t\treturn SavedRaid.equals(a, b);\n\t\t\t},\n\t\t\ttoJson: (a: SavedRaid) => SavedRaid.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedRaid.fromJson(obj),\n\t\t});\n\t\tthis.sim.waitForInit().then(() => {\n\t\t\tsavedRaidManager.loadUserData();\n\t\t});\n\t}\n\n\tprivate addSettingsTab() {\n\t\tthis.addTab('SETTINGS', 'raid-settings-tab', `\n\t\t\t<div class=\"raid-settings-sections\">\n\t\t\t\t<div class=\"settings-section-container raid-settings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section raid-encounter-section\">\n\t\t\t\t\t\t<legend>Encounter</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container blessings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section blessings-section\">\n\t\t\t\t\t\t<legend>Blessings</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container assignments-section-container\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container tanks-section-container\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"settings-section-container raid-settings-section-container\">\n\t\t\t\t\t<fieldset class=\"settings-section other-options-section\">\n\t\t\t\t\t\t<legend>Other Options</legend>\n\t\t\t\t\t</fieldset>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"settings-bottom-bar\">\n\t\t\t\t<div class=\"saved-encounter-manager\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tconst encounterSectionElem = this.rootElem.getElementsByClassName('raid-encounter-section')[0] as HTMLElement;\n\t\tnew EncounterPicker(encounterSectionElem, this.sim.encounter, {\n\t\t\tshowExecuteProportion: true,\n\t\t}, this);\n\t\tconst savedEncounterManager = new SavedDataManager<Encounter, SavedEncounter>(this.rootElem.getElementsByClassName('saved-encounter-manager')[0] as HTMLElement, this.sim.encounter, {\n\t\t\tlabel: 'Encounter',\n\t\t\tstorageKey: this.getSavedEncounterStorageKey(),\n\t\t\tgetData: (encounter: Encounter) => SavedEncounter.create({ encounter: encounter.toProto() }),\n\t\t\tsetData: (eventID: EventID, encounter: Encounter, newEncounter: SavedEncounter) => encounter.fromProto(eventID, newEncounter.encounter!),\n\t\t\tchangeEmitters: [this.sim.encounter.changeEmitter],\n\t\t\tequals: (a: SavedEncounter, b: SavedEncounter) => SavedEncounter.equals(a, b),\n\t\t\ttoJson: (a: SavedEncounter) => SavedEncounter.toJson(a),\n\t\t\tfromJson: (obj: any) => SavedEncounter.fromJson(obj),\n\t\t});\n\t\tthis.sim.waitForInit().then(() => {\n\t\t\tsavedEncounterManager.loadUserData();\n\t\t});\n\n\t\tconst blessingsSection = this.rootElem.getElementsByClassName('blessings-section')[0] as HTMLElement;\n\t\tthis.blessingsPicker = new BlessingsPicker(blessingsSection, this);\n\t\tthis.blessingsPicker.changeEmitter.on(eventID => this.changeEmitter.emit(eventID));\n\t\ttippy(blessingsSection, {\n\t\t\tcontent: Tooltips.BLESSINGS_SECTION,\n\t\t\tallowHTML: true,\n\t\t\tplacement: 'left',\n\t\t});\n\n\t\tconst assignmentsPicker = new AssignmentsPicker(this.rootElem.getElementsByClassName('assignments-section-container')[0] as HTMLElement, this);\n\t\tconst tanksPicker = new TanksPicker(this.rootElem.getElementsByClassName('tanks-section-container')[0] as HTMLElement, this);\n\n\t\tconst otherOptionsSectionElem = this.rootElem.getElementsByClassName('other-options-section')[0] as HTMLElement;\n\t\t//new BooleanPicker(otherOptionsSectionElem, this.sim.raid, {\n\t\t//\tlabel: 'Stagger Stormstrikes',\n\t\t//\tlabelTooltip: 'When there are multiple Enhancement Shaman in the raid, causes them to coordinate their Stormstrike casts for optimal SS charge usage.',\n\t\t//\tchangedEvent: (raid: Raid) => raid.staggerStormstrikesChangeEmitter,\n\t\t//\tgetValue: (raid: Raid) => raid.getStaggerStormstrikes(),\n\t\t//\tsetValue: (eventID: EventID, raid: Raid, newValue: boolean) => {\n\t\t//\t\traid.setStaggerStormstrikes(eventID, newValue);\n\t\t//\t},\n\t\t//});\n\n\t\t// Init Muuri layout only when settings tab is clicked, because it needs the elements\n\t\t// to be shown so it can calculate sizes.\n\t\t(this.rootElem.getElementsByClassName('raid-settings-tab-tab')[0] as HTMLElement)!.addEventListener('click', event => {\n\t\t\tif (this.settingsMuuri == null) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.settingsMuuri = new Muuri('.raid-settings-sections');\n\t\t\t\t}, 200); // Magic amount of time before Muuri init seems to work\n\t\t\t}\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.recomputeSettingsLayout();\n\t\t\t}, 200);\n\t\t});\n\t}\n\n\tprivate addDetailedResultsTab() {\n\t\tthis.addTab('DETAILED RESULTS', 'detailed-results-tab', `\n\t\t\t<div class=\"detailed-results\">\n\t\t\t</div>\n\t\t`);\n\n\t\tconst detailedResults = new DetailedResults(this.rootElem.getElementsByClassName('detailed-results')[0] as HTMLElement, this, this.raidSimResultsManager!);\n\t}\n\n\tprivate addLogTab() {\n\t\tthis.addTab('LOG', 'log-tab', `\n\t\t\t<div class=\"log-runner\">\n\t\t\t</div>\n\t\t`);\n\n\t\tconst logRunner = new LogRunner(this.rootElem.getElementsByClassName('log-runner')[0] as HTMLElement, this);\n\t}\n\n\tprivate recomputeSettingsLayout() {\n\t\tif (this.settingsMuuri) {\n\t\t\t//this.settingsMuuri.refreshItems();\n\t\t}\n\t\twindow.dispatchEvent(new Event('resize'));\n\t}\n\n\tprivate modifyRaidProto(raidProto: RaidProto) {\n\t\t// Invoke all the buff bot callbacks.\n\t\tthis.getBuffBots().forEach(buffBot => {\n\t\t\tconst partyProto = raidProto.parties[buffBot.getPartyIndex()];\n\t\t\tif (!partyProto) {\n\t\t\t\tthrow new Error('No party proto for party index: ' + buffBot.getPartyIndex());\n\t\t\t}\n\t\t\tbuffBot.settings.modifyRaidProto(buffBot, raidProto, partyProto);\n\t\t});\n\n\t\t// Apply blessings.\n\t\tconst numPaladins = this.getClassCount(Class.ClassPaladin);\n\t\tconst blessingsAssignments = this.blessingsPicker!.getAssignments();\n\t\timplementedSpecs.forEach(spec => {\n\t\t\tconst playerProtos = raidProto.parties\n\t\t\t\t.map(party => party.players.filter(player => player.class != Class.ClassUnknown && playerToSpec(player) == spec))\n\t\t\t\t.flat();\n\n\t\t\tblessingsAssignments.paladins.forEach((paladin, i) => {\n\t\t\t\tif (i >= numPaladins) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (paladin.blessings[spec] == Blessings.BlessingOfKings) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfKings = true);\n\t\t\t\t} else if (paladin.blessings[spec] == Blessings.BlessingOfMight) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfMight = TristateEffect.TristateEffectImproved);\n\t\t\t\t} else if (paladin.blessings[spec] == Blessings.BlessingOfWisdom) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfWisdom = TristateEffect.TristateEffectImproved);\n\t\t\t\t} else if (paladin.blessings[spec] == Blessings.BlessingOfSanctuary) {\n\t\t\t\t\tplayerProtos.forEach(playerProto => playerProto.buffs!.blessingOfSanctuary = true);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCurrentData(): ReferenceData | null {\n\t\tif (this.raidSimResultsManager) {\n\t\t\treturn this.raidSimResultsManager.getCurrentData();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetReferenceData(): ReferenceData | null {\n\t\tif (this.raidSimResultsManager) {\n\t\t\treturn this.raidSimResultsManager.getReferenceData();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tgetClassCount(playerClass: Class): number {\n\t\treturn this.sim.raid.getClassCount(playerClass)\n\t\t\t+ this.getBuffBots()\n\t\t\t\t.filter(buffBot => buffBot.getClass() == playerClass).length;\n\t}\n\n\tgetBuffBots(): Array<BuffBot> {\n\t\treturn this.raidPicker!.getBuffBots();\n\t}\n\n\tsetBuffBots(eventID: EventID, buffBotProtos: BuffBotProto[]): void {\n\t\tthis.raidPicker!.setBuffBots(eventID, buffBotProtos);\n\t}\n\n\tclearBuffBots(eventID: EventID): void {\n\t\tthis.raidPicker!.setBuffBots(eventID, []);\n\t}\n\n\tgetPlayersAndBuffBots(): Array<Player<any> | BuffBot | null> {\n\t\tconst players = this.sim.raid.getPlayers();\n\t\tconst buffBots = this.getBuffBots();\n\n\t\tconst playersAndBuffBots: Array<Player<any> | BuffBot | null> = players.slice();\n\t\tbuffBots.forEach(buffBot => {\n\t\t\tplayersAndBuffBots[buffBot.getRaidIndex()] = buffBot;\n\t\t});\n\n\t\treturn playersAndBuffBots;\n\t}\n\n\tapplyDefaults(eventID: EventID) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tthis.sim.raid.fromProto(eventID, RaidProto.create());\n\t\t\tthis.sim.encounter.applyDefaults(eventID);\n\t\t\tthis.sim.applyDefaults(eventID, true);\n\t\t});\n\t}\n\n\ttoProto(): RaidSimSettings {\n\t\treturn RaidSimSettings.create({\n\t\t\tsettings: this.sim.toProto(),\n\t\t\traid: this.sim.raid.toProto(true),\n\t\t\tbuffBots: this.getBuffBots().map(b => b.toProto()),\n\t\t\tblessings: this.blessingsPicker!.getAssignments(),\n\t\t\tencounter: this.sim.encounter.toProto(),\n\t\t});\n\t}\n\n\ttoLink(): string {\n\t\tconst proto = this.toProto();\n\t\t// When sharing links, people generally don't intend to share settings.\n\t\tproto.settings = undefined;\n\n\t\tconst protoBytes = RaidSimSettings.toBinary(proto);\n\t\tconst deflated = pako.deflate(protoBytes, { to: 'string' });\n\t\tconst encoded = btoa(String.fromCharCode(...deflated));\n\n\t\tconst linkUrl = new URL(window.location.href);\n\t\tlinkUrl.hash = encoded;\n\t\treturn linkUrl.toString();\n\t}\n\n\tfromProto(eventID: EventID, settings: RaidSimSettings) {\n\t\tTypedEvent.freezeAllAndDo(() => {\n\t\t\tif (settings.settings) {\n\t\t\t\tthis.sim.fromProto(eventID, settings.settings);\n\t\t\t}\n\t\t\tthis.sim.raid.fromProto(eventID, settings.raid || RaidProto.create());\n\t\t\tthis.sim.encounter.fromProto(eventID, settings.encounter || EncounterProto.create());\n\t\t\tthis.raidPicker!.setBuffBots(eventID, settings.buffBots);\n\t\t\tthis.blessingsPicker!.setAssignments(eventID, settings.blessings || BlessingsAssignments.create());\n\t\t});\n\t}\n\n\tclearRaid(eventID: EventID) {\n\t\tthis.sim.raid.clear(eventID);\n\t\tthis.clearBuffBots(eventID);\n\t}\n\n\t// Returns the actual key to use for local storage, based on the given key part and the site context.\n\tgetStorageKey(keyPart: string): string {\n\t\treturn '__wotlk_raid__' + keyPart;\n\t}\n\n\tgetSavedRaidStorageKey(): string {\n\t\treturn this.getStorageKey('__savedRaid__');\n\t}\n}\n","import { RaidSimUI } from './raid_sim_ui.js';\n\nconst ui = new RaidSimUI(document.body, {});\n"],"names":["RaidTargetPicker","Input","constructor","parent","raid","modObj","config","super","this","rootElem","classList","add","curPlayer","getPlayerFromRaidTarget","getValue","curRaidTarget","getInputValue","noTargetOption","iconUrl","text","noTargetLabel","color","value","isDropdown","innerHTML","buttonElem","getElementsByClassName","dropdownElem","addEventListener","event","preventDefault","currentOptions","updateOptions","TypedEvent","nextEventID","compChangeEmitter","on","eventID","init","makeTargetOptions","playerOptions","getPlayers","filter","player","map","getTalentTreeIcon","getLabel","getClassColor","concat","forEach","option","appendChild","makeOption","prevRaidTarget","RaidTarget","equals","setInputValue","inputChanged","data","makeOptionElem","getInputElem","makeRaidTarget","emptyRaidTarget","newValue","clone","optionData","find","static","optionContainer","document","createElement","style","backgroundColor","icon","src","label","textContent","specSimFactories","Spec","SpecDeathknight","parentElem","DeathknightSimUI","SpecBalanceDruid","BalanceDruidSimUI","SpecFeralDruid","FeralDruidSimUI","SpecFeralTankDruid","FeralTankDruidSimUI","SpecElementalShaman","ElementalShamanSimUI","SpecEnhancementShaman","EnhancementShamanSimUI","SpecHunter","HunterSimUI","SpecMage","MageSimUI","SpecRogue","RogueSimUI","SpecRetributionPaladin","RetributionPaladinSimUI","SpecProtectionPaladin","ProtectionPaladinSimUI","SpecShadowPriest","ShadowPriestSimUI","SpecSmitePriest","SmitePriestSimUI","SpecWarrior","WarriorSimUI","SpecProtectionWarrior","ProtectionWarriorSimUI","SpecWarlock","WarlockSimUI","playerPresets","spec","rotation","DeathknightPresets.DefaultFrostRotation","talents","DeathknightPresets.FrostTalents","specOptions","DeathknightPresets.DefaultFrostOptions","consumes","DeathknightPresets.DefaultConsumes","defaultName","defaultFactionRaces","Faction","Unknown","Race","RaceUnknown","Alliance","RaceHuman","Horde","RaceTroll","defaultGear","DeathknightPresets.P1_FROST_BIS_PRESET","gear","otherDefaults","DeathknightPresets.OtherDefaults","tooltip","talentTreeIcons","Class","ClassDeathknight","DeathknightPresets.DefaultUnholyRotation","DeathknightPresets.UnholyDualWieldTalents","DeathknightPresets.DefaultUnholyOptions","DeathknightPresets.P1_UNHOLY_DW_BIS_PRESET","BalanceDruidPresets.DefaultRotation","BalanceDruidPresets.StandardTalents","BalanceDruidPresets.DefaultOptions","BalanceDruidPresets.DefaultConsumes","RaceNightElf","RaceTauren","BalanceDruidPresets.P1_PRESET","specNames","specIconsLarge","FeralDruidPresets.DefaultRotation","FeralDruidPresets.StandardTalents","FeralDruidPresets.DefaultOptions","FeralDruidPresets.DefaultConsumes","FeralDruidPresets.P1_PRESET","FeralTankDruidPresets.DefaultRotation","FeralTankDruidPresets.StandardTalents","FeralTankDruidPresets.DefaultOptions","FeralTankDruidPresets.DefaultConsumes","FeralTankDruidPresets.P1_PRESET","HunterPresets.DefaultRotation","HunterPresets.BeastMasteryTalents","HunterPresets.BMDefaultOptions","HunterPresets.DefaultConsumes","RaceOrc","HunterPresets.P1_PRESET","ClassHunter","HunterPresets.MarksmanTalents","HunterPresets.DefaultOptions","HunterPresets.SurvivalTalents","MagePresets.DefaultArcaneRotation","MagePresets.ArcaneTalents","MagePresets.DefaultArcaneOptions","MagePresets.DefaultArcaneConsumes","RaceGnome","MagePresets.P1_ARCANE_PRESET","ClassMage","MagePresets.DefaultFireRotation","MagePresets.FireTalents","MagePresets.DefaultFireOptions","MagePresets.DefaultFireConsumes","MagePresets.P1_FIRE_PRESET","MagePresets.DefaultFrostRotation","MagePresets.FrostTalents","MagePresets.DefaultFrostOptions","MagePresets.DefaultFrostConsumes","MagePresets.P1_FROST_PRESET","RoguePresets.DefaultRotation","RoguePresets.CombatTalents","RoguePresets.DefaultOptions","RoguePresets.DefaultConsumes","RoguePresets.P1_PRESET","ElementalShamanPresets.DefaultRotation","ElementalShamanPresets.StandardTalents","ElementalShamanPresets.DefaultOptions","ElementalShamanPresets.DefaultConsumes","RaceDraenei","ElementalShamanPresets.P1_PRESET","EnhancementShamanPresets.DefaultRotation","EnhancementShamanPresets.StandardTalents","EnhancementShamanPresets.DefaultOptions","EnhancementShamanPresets.DefaultConsumes","EnhancementShamanPresets.P1_PRESET","ShadowPriestPresets.DefaultRotation","ShadowPriestPresets.StandardTalents","ShadowPriestPresets.DefaultOptions","ShadowPriestPresets.DefaultConsumes","RaceDwarf","RaceUndead","ShadowPriestPresets.P1_PRESET","SmitePriestPresets.DefaultRotation","SmitePriestPresets.StandardTalents","SmitePriestPresets.DefaultOptions","SmitePriestPresets.DefaultConsumes","SmitePriestPresets.P1_PRESET","WarriorPresets.ArmsRotation","WarriorPresets.ArmsTalents","WarriorPresets.DefaultOptions","WarriorPresets.DefaultConsumes","WarriorPresets.P1_ARMS_PRESET","ClassWarrior","WarriorPresets.DefaultRotation","WarriorPresets.FuryTalents","WarriorPresets.P1_FURY_PRESET","ProtectionWarriorPresets.DefaultRotation","ProtectionWarriorPresets.ImpaleProtTalents","ProtectionWarriorPresets.DefaultOptions","ProtectionWarriorPresets.DefaultConsumes","ProtectionWarriorPresets.P1_BALANCED_PRESET","RetributionPaladinPresets.DefaultRotation","RetributionPaladinPresets.AuraMasteryTalents","RetributionPaladinPresets.DefaultOptions","RetributionPaladinPresets.DefaultConsumes","RaceBloodElf","RetributionPaladinPresets.P1_PRESET","RetributionPaladinPresets.P2_PRESET","RetributionPaladinPresets.P3_PRESET","RetributionPaladinPresets.P4_PRESET","RetributionPaladinPresets.P5_PRESET","ClassPaladin","ProtectionPaladinPresets.DefaultRotation","ProtectionPaladinPresets.GenericAoeTalents","ProtectionPaladinPresets.DefaultOptions","ProtectionPaladinPresets.DefaultConsumes","ProtectionPaladinPresets.P1_PRESET","WarlockPresets.AfflictionRotation","WarlockPresets.AfflictionTalents","WarlockPresets.AfflictionOptions","WarlockPresets.DefaultConsumes","WarlockPresets.OtherDefaults","ClassWarlock","implementedSpecs","Set","preset","buffBotPresets","buffBotId","deprecated","name","modifyRaidProto","buffBot","raidProto","partyProto","buffs","giftOfTheWild","Math","max","TristateEffect","TristateEffectRegular","thorns","debuffs","faerieFire","leaderOfThePack","innervateIndex","getInnervateAssignment","targetIndex","NO_TARGET","partyIndex","floor","playerIndex","playerProto","parties","players","innervates","TristateEffectImproved","arcaneBrilliance","judgementOfWisdom","ClassPriest","shadowProtection","powerWordFortitude","divineSpirit","powerInfusionIndex","getPowerInfusionAssignment","powerInfusions","tricksOfTheTradeIndex","getTricksOfTheTradeAssignment","tricksOfTheTrades","ClassShaman","bloodlust","manaSpringTotem","manaTideTotems","woaSpecs","wfSpecs","woaVotes","wfVotes","specs","class","ClassUnknown","playerToSpec","playerSpec","includes","length","wrathOfAirTotem","windfuryTotem","battleShout","sunderArmor","bloodFrenzy","BuffBot","id","sim","raidIndex","innervateAssignment","powerInfusionAssignment","tricksOfTheTradeAssignment","raidIndexChangeEmitter","innervateAssignmentChangeEmitter","powerInfusionAssignmentChangeEmitter","tricksOfTheTradeAssignmentChangeEmitter","changeEmitter","settings","Error","updateSettings","emitter","emit","getParty","getPartyIndex","getRaidIndex","getClass","specToClass","classColors","setRaidIndex","newRaidIndex","freezeAllAndDo","setInnervateAssignment","newInnervateAssignment","setPowerInfusionAssignment","newPowerInfusionAssignment","setTricksOfTheTradeAssignment","newTricksOfTheTradeAssignment","toProto","BuffBotProto","create","fromProto","proto","newBuffBot","AssignmentsPicker","Component","raidSimUI","innervatesPicker","InnervatesPicker","powerInfusionsPicker","PowerInfusionsPicker","tricksOfTheTradesPicker","TricksOfTheTradesPicker","AssignedBuffPicker","targetPickers","playersContainer","update","getTitle","toUpperCase","sourcePlayers","getSourcePlayers","display","sourcePlayer","sourcePlayerIndex","row","sourceElem","Player","arrow","raidTargetPicker","extraCssClasses","changedEvent","specOptionsChangeEmitter","getPlayerValue","setValue","setPlayerValue","getBuffBotValue","setBuffBotValue","targetPickerData","playerOrBot","targetPicker","targetPlayer","getPlayersAndBuffBots","ClassDruid","getSpecOptions","innervateTarget","newOptions","setSpecOptions","getTalents","powerInfusion","powerInfusionTarget","ClassRogue","tricksOfTheTradeTarget","BlessingsPicker","assignments","BlessingsAssignments","makeDefaultBlessings","bodyElem","naturalSpecOrder","paladinIndexes","Array","keys","cols","rows","headerCell","titleIcons","tippy","content","allowHTML","paladinIdx","cell","push","IconEnumPicker","numColumns","values","Blessings","BlessingUnknown","actionId","ActionId","fromSpellId","BlessingOfKings","BlessingOfMight","BlessingOfWisdom","BlessingOfSanctuary","a","b","zeroValue","picker","paladins","blessings","setNumPaladins","getClassCount","numPaladins","min","i","elem","remove","getAssignments","setAssignments","newAssignments","RaidJsonImporter","Importer","simUI","descriptionElem","onImport","RaidSimSettings","fromJsonString","close","RaidJsonExporter","Exporter","getData","JSON","stringify","toJson","RaidWCLImporter","queryCounter","getWCLBearerToken","fetch","method","headers","Authorization","btoa","body","URLSearchParams","grant_type","then","response","json","res","access_token","catch","err","console","error","queryWCL","query","token","Accept","queryURL","encodeURI","getURLInfo","url","urlInfo","reportID","fightID","fightIDIndex","indexOf","reportIDIndex","parseInt","substring","isNaN","toString","warn","getRateLimit","async","importLink","importButton","disabled","cursor","doImport","removeProperty","clearRaid","rateLimitStart","experimentalGenerateParties","pointsSpentThisHour","limitPerHour","info","reportDataQuery","reportData","errors","errorData","reduce","accumulator","message","alert","wclData","report","guildData","guild","playerData","playerDetails","entries","innervateData","powerInfusionData","tricksOfTheTradeData","tricksOfTheTrade","fight","fights","startTime","endTime","faction","raidPicker","getCurrentFaction","encounter","EncounterProto","duration","targets","closestEncounterPreset","getAllPresetEncounters","enc","path","mob","target","Target","defaultProto","RaidProto","buffBots","wclIDtoRaidIndex","Map","type","tempParties","from","MAX_NUM_PARTIES","PartyProto","sortByProperty","objArray","prop","isArray","slice","direct","arguments","propPath","split","sort","p","match","mappedPlayers","wclPlayer","WCLSimPlayer","processBuffCastData","buffCastData","playerCasts","cast","isBuffBot","wclPlayers","sortBuffBotsLast","assignPlayerToParty","raidParty","missing","MAX_PARTY_SIZE","getBuffBot","simPlayer","getPlayer","set","PlayerProto","isTankSpec","rt","get","tanks","partyAssigned","partyBuffPlayers","isPartyBuffer","partyFull","partyMembers","auraIDs","getPartyAuraIds","auraBuffQueries","auraID","auraTargets","auraQueryRes","playerAuras","table","auras","auraTarget","bands","index","uniqueAuraTargets","some","partyFound","raidMember","totalPartyMembers","findIndex","party","member","partyMember","isUndefined","isFull","targetID","targetRaidIndex","playerID","playerRaidIndex","raidPlayer","oneofKind","balanceDruid","options","feralDruid","feralTankDruid","setBuffBots","rateLimitEnd","debug","pointsResetIn","sortPriority","wclSpec","specType","specSortPriority","specFuncs","specTypeFunctions","matchingPreset","getMatchingPreset","withSpecProto","talentsCreate","talentsString","glyphs","nameToClass","equipment","getEquipment","race","applySharedDefaultsToProto","botID","buffBotNames","bot","feralDruidSpecAuras","specSpecificAuras","RetributionPaladin","GuardianDruid","WardenDruid","FeralDruid","BalanceDruid","RestorationDruid","MarksmanHunter","EnhancementShaman","classAuras","Paladin","Warrior","Warlock","reliableAuras","matchingPresets","presetIdx","distance","presetTalents","talentIdx","v","newDistance","acc","abs","guid","EquipmentSpec","items","item","ItemSpec","dbEnchant","getEnchantFlexible","permanentEnchant","enchant","gems","gemInfo","Warden","Guardian","Feral","Balance","Justicar","Retribution","Fury","Arms","Protection","Enhancement","Destruction","Affliction","Demonology","Marksman","Elemental","Survival","BeastMastery","Arcane","Fire","Frost","Assassination","Combat","Shadow","Smite","Champion","Gladiator","HolyPaladin","HolyPriest","DisciplinePriest","DreamstateDruid","RestorationShaman","RaidPicker","currentDragPlayer","currentDragPlayerFromIndex","currentDragType","raidViewer","partiesContainer","partyPickers","getParties","PartyPicker","newPlayerPickerRoot","newPlayerPicker","NewPlayerPicker","ondragend","clearDragPlayer","getFaction","getCurrentPhase","getPhase","getPlayerPicker","playerPickers","getPlayerPickers","getBuffBots","newBuffBotProtos","setPlayer","buffBotProto","setDragPlayer","fromIndex","PlayerPicker","dpsResultElem","referenceDeltaElem","referenceChangeEmitter","currentData","getCurrentData","referenceData","getReferenceData","partyDps","simResult","raidMetrics","dps","avg","referenceDps","toFixed","formatDeltaTextElem","partyPicker","newPlayer","labelElem","iconElem","nameElem","resultsElem","setName","keyCode","realPlayerPickers","pp","indexOfThis","focus","blur","emptyName","selection","window","getSelection","range","createRange","selectNodeContents","removeAllRanges","addRange","dragStart","dataTransfer","dropEffect","effectAllowed","iconSrc","dragImage","Image","setDragImage","playerDataProto","setData","String","fromCharCode","toBinary","ondragstart","copyElem","deleteElem","dragEnterCounter","ondragenter","ondragleave","ondragover","ondrop","dropData","dragType","fromPlayerPicker","myicon","binary","atob","bytes","Uint8Array","charCodeAt","fromBinary","localPlayer","editElem","PlayerEditorModal","playerDps","getDamageMetrics","getTanks","emptyIdx","tank","setTanks","newRaidTarget","setBalanceDruidSelfInnervate","setSmitePriestSelfPI","setAttribute","removeAttribute","getName","CloseButton","$","bPopup","editorRoot","closeClass","onClose","EnumPicker","labelTooltip","factionChangeEmitter","setFaction","phaseChangeEmitter","setPhase","presetsContainer","getEnumValues","wowClass","classPresetsContainer","hexToRgba","presetElem","presetIconElem","applySharedDefaults","setRace","setRotation","setTalentsString","setGlyphs","Glyphs","setConsumes","setProfession1","profession1","Profession","Engineering","setProfession2","profession2","Jewelcrafting","setDistanceFromTarget","distanceFromTarget","waitForInit","setGear","lookupEquipmentSpec","buffbotsTooltip","buffbotsContainer","matchingBuffBots","matchingBuffBot","TanksPicker","tanksContainer","tankIndex","tanksChangeEmitter","raid2","extraKnownIssues","SimUI","Sim","launchStatus","LaunchStatus","Unlaunched","knownIssues","raidSimResultsManager","blessingsPicker","settingsMuuri","setModifyRaidProto","loadSettings","addSidebarComponents","addTopbarComponents","addRaidTab","addSettingsTab","addDetailedResultsTab","addLogTab","recomputeSettingsLayout","initEventID","loadedSettings","savedSettings","localStorage","getItem","getSettingsStorageKey","e","applyDefaults","jsonStr","toJsonString","setItem","addRaidSimAction","addToolbarItem","importSettings","linkElem","menuElem","addMenuItem","experimental","onClick","itemElem","newRaidImporters","exportSettings","newRaidExporters","settingsMenu","SettingsMenu","addTab","savedRaidManager","SavedDataManager","storageKey","getSavedRaidStorageKey","SavedRaid","phase","newRaid","changeEmitters","fromJson","obj","loadUserData","encounterSectionElem","EncounterPicker","showExecuteProportion","savedEncounterManager","getSavedEncounterStorageKey","SavedEncounter","newEncounter","blessingsSection","Tooltips.BLESSINGS_SECTION","placement","setTimeout","Muuri","DetailedResults","LogRunner","dispatchEvent","Event","blessingsAssignments","playerProtos","flat","paladin","blessingOfKings","blessingOfMight","blessingOfWisdom","blessingOfSanctuary","playerClass","buffBotProtos","clearBuffBots","playersAndBuffBots","toLink","protoBytes","deflated","pako","deflate","to","encoded","linkUrl","URL","location","href","hash","clear","getStorageKey","keyPart"],"mappings":"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"}